{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "f743b7ee-7b64-4795-8fde-4a13bb19b9a4",
            "version": "KqlParameterItem/1.0",
            "name": "DefaultSubscription",
            "type": 1,
            "isRequired": true,
            "query": "where type =~ 'microsoft.operationalinsights/workspaces'\n| take 1\n| project subscriptionId",
            "crossComponentResources": [
              "value::selected"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "42cd108c-31c6-40f4-b65d-7ad491fbd2f6",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "label": "‚òÅÔ∏è Subscription",
            "type": 6,
            "description": "The Azure Subscription where Microsoft Sentinel is located",
            "query": "summarize by subscriptionId\n| project value = strcat(\"/subscriptions/\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription}', true, false)\n",
            "crossComponentResources": [
              "value::selected"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "012c4b93-9eb5-4a65-adc5-d727ed948ab4",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "label": "üóÇÔ∏è Workspace",
            "type": 5,
            "description": "The Microsoft Sentinel Workspace",
            "isRequired": true,
            "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n//| where subscriptionId == '{Subscription:id}'\r\n| project id",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "typeSettings": {
              "resourceTypeFilter": {
                "microsoft.operationalinsights/workspaces": true
              },
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": ""
          },
          {
            "id": "7e7c4ba7-96cc-4d54-9cef-e3fba41bc2ae",
            "version": "KqlParameterItem/1.0",
            "name": "Retention",
            "label": "‚åõ Workspace Retention",
            "type": 1,
            "description": "Automatically calculated from Log Analytics Workspace",
            "query": "resources\n| where type =~ 'microsoft.operationalinsights/workspaces' \n| where id has \"{Workspace}\"\n| extend retentionDays = trim(' ', tostring(properties.retentionInDays))\n| project retentionDays",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "e05b16d2-3c32-4653-a124-d57db73061a7",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "‚è±Ô∏è Time Range",
            "type": 4,
            "description": "The time you wish to lookback over",
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ]
            },
            "value": {
              "durationMs": 7776000000
            }
          },
          {
            "id": "6622b50f-a532-4248-a193-64211fffd9f1",
            "version": "KqlParameterItem/1.0",
            "name": "sku",
            "label": "ü™¥ SKU Name",
            "type": 2,
            "description": "The Microsoft Sentinel ingestion SKU",
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n  { \"value\": \"pay-as-you-go\", \"label\": \"Pay-as-you-go\", \"selected\": true },\r\n  { \"value\": \"100-gb-commitment-tier\", \"label\": \"100 GB Commitment Tier\" },\r\n  { \"value\": \"200-gb-commitment-tier\", \"label\": \"200 GB Commitment Tier\" },\r\n  { \"value\": \"300-gb-commitment-tier\", \"label\": \"300 GB Commitment Tier\" },\r\n  { \"value\": \"400-gb-commitment-tier\", \"label\": \"400 GB Commitment Tier\" },\r\n  { \"value\": \"500-gb-commitment-tier\", \"label\": \"500 GB Commitment Tier\" },\r\n  { \"value\": \"2000-gb-commitment-tier\", \"label\": \"2000 GB Commitment Tier\" },\r\n  { \"value\": \"5000-gb-commitment-tier\", \"label\": \"5000 GB Commitment Tier\" },\r\n  { \"value\": \"10000-gb-commitment-tier\", \"label\": \"10000 GB Commitment Tier\" },\r\n  { \"value\": \"25000-gb-commitment-tier\", \"label\": \"25000 GB Commitment Tier\" },\r\n  { \"value\": \"50000-gb-commitment-tier\", \"label\": \"50000 GB Commitment Tier\" }\r\n]"
          },
          {
            "id": "03e12e0b-0042-49e2-a820-8b2b9661fbfb",
            "version": "KqlParameterItem/1.0",
            "name": "currency",
            "label": "üí± Currency",
            "type": 2,
            "description": "The currency you wish to view the workbook in",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n  { \"value\": \"GBP\", \"label\": \"Pound Stirling (¬£)\", \"selected\": true },\r\n  { \"value\": \"EUR\", \"label\": \"Euro (‚Ç¨)\" },\r\n  { \"value\": \"USD\", \"label\": \"United States Dollar ($)\" }\r\n]"
          },
          {
            "id": "90e2c6eb-7157-4b8e-84fd-89d7e2bf0fb2",
            "version": "KqlParameterItem/1.0",
            "name": "region",
            "label": "üåê Azure Region",
            "type": 2,
            "description": "The Azure region where your data is located",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n  { \"value\": \"AE Central\", \"label\": \"AE Central\" },\r\n  { \"value\": \"AE North\", \"label\": \"AE North\" },\r\n  { \"value\": \"AP East\", \"label\": \"AP East\" },\r\n  { \"value\": \"AP Southeast\", \"label\": \"AP Southeast\" },\r\n  { \"value\": \"AU Central\", \"label\": \"AU Central\" },\r\n  { \"value\": \"AU Central 2\", \"label\": \"AU Central 2\" },\r\n  { \"value\": \"AU East\", \"label\": \"AU East\" },\r\n  { \"value\": \"AU Southeast\", \"label\": \"AU Southeast\" },\r\n  { \"value\": \"BR South\", \"label\": \"BR South\" },\r\n  { \"value\": \"BR Southeast\", \"label\": \"BR Southeast\" },\r\n  { \"value\": \"CA Central\", \"label\": \"CA Central\" },\r\n  { \"value\": \"CA East\", \"label\": \"CA East\" },\r\n  { \"value\": \"CH North\", \"label\": \"CH North\" },\r\n  { \"value\": \"CH West\", \"label\": \"CH West\" },\r\n  { \"value\": \"DE North\", \"label\": \"DE North\" },\r\n  { \"value\": \"DE West Central\", \"label\": \"DE West Central\" },\r\n  { \"value\": \"ES Central\", \"label\": \"ES Central\" },\r\n  { \"value\": \"EU North\", \"label\": \"EU North\" },\r\n  { \"value\": \"EU West\", \"label\": \"EU West\" },\r\n  { \"value\": \"FR Central\", \"label\": \"FR Central\" },\r\n  { \"value\": \"FR South\", \"label\": \"FR South\" },\r\n  { \"value\": \"Global\", \"label\": \"Global\" },\r\n  { \"value\": \"IL Central\", \"label\": \"IL Central\" },\r\n  { \"value\": \"IN Central\", \"label\": \"IN Central\" },\r\n  { \"value\": \"IN Central Jio\", \"label\": \"IN Central Jio\" },\r\n  { \"value\": \"IN South\", \"label\": \"IN South\" },\r\n  { \"value\": \"IN West\", \"label\": \"IN West\" },\r\n  { \"value\": \"IN West Jio\", \"label\": \"IN West Jio\" },\r\n  { \"value\": \"IT North\", \"label\": \"IT North\" },\r\n  { \"value\": \"JA East\", \"label\": \"JA East\" },\r\n  { \"value\": \"JA West\", \"label\": \"JA West\" },\r\n  { \"value\": \"KR Central\", \"label\": \"KR Central\" },\r\n  { \"value\": \"KR South\", \"label\": \"KR South\" },\r\n  { \"value\": \"MX Central\", \"label\": \"MX Central\" },\r\n  { \"value\": \"NO East\", \"label\": \"NO East\" },\r\n  { \"value\": \"NO West\", \"label\": \"NO West\" },\r\n  { \"value\": \"PL Central\", \"label\": \"PL Central\" },\r\n  { \"value\": \"QA Central\", \"label\": \"QA Central\" },\r\n  { \"value\": \"SE Central\", \"label\": \"SE Central\" },\r\n  { \"value\": \"SE South\", \"label\": \"SE South\" },\r\n  { \"value\": \"UK South\", \"label\": \"UK South\", \"selected\": true },\r\n  { \"value\": \"UK West\", \"label\": \"UK West\" },\r\n  { \"value\": \"US Central\", \"label\": \"US Central\" },\r\n  { \"value\": \"US East\", \"label\": \"US East\" },\r\n  { \"value\": \"US East 2\", \"label\": \"US East 2\" },\r\n  { \"value\": \"US Gov AZ\", \"label\": \"US Gov AZ\" },\r\n  { \"value\": \"US Gov Virginia\", \"label\": \"US Gov Virginia\" },\r\n  { \"value\": \"US North Central\", \"label\": \"US North Central\" },\r\n  { \"value\": \"US South Central\", \"label\": \"US South Central\" },\r\n  { \"value\": \"US West\", \"label\": \"US West\" },\r\n  { \"value\": \"US West 2\", \"label\": \"US West 2\" },\r\n  { \"value\": \"US West 3\", \"label\": \"US West 3\" },\r\n  { \"value\": \"US West Central\", \"label\": \"US West Central\" },\r\n  { \"value\": \"ZA North\", \"label\": \"ZA North\" },\r\n  { \"value\": \"ZA West\", \"label\": \"ZA West\" }\r\n]"
          },
          {
            "id": "3c5b0401-92d3-496d-ab15-602cce5e27da",
            "version": "KqlParameterItem/1.0",
            "name": "paygCost",
            "label": "üíµ Ingestion Cost",
            "type": 1,
            "description": "Automantically calculated from the Azure region and Currency selection",
            "query": "let jsonData = externaldata(\r\n    skuName:string,\r\n    unitOfMeasure:string,\r\n    type:string,\r\n    retailPrice:real,\r\n    unitPrice:real,\r\n    currencyCode:string,\r\n    location:string,\r\n    effectiveStartDate:datetime,\r\n    meterId:string,\r\n    meterName:string,\r\n    skuId:string,\r\n    productName:string,\r\n    serviceFamily:string\r\n)\r\n[\r\n    h@\"https://raw.githubusercontent.com/noodlemctwoodle/SentinelPublic/main/ExternalData/AllSentinelPrices.json\"\r\n]\r\nwith (format=\"multijson\");\r\njsonData\r\n| where skuName == \"{sku:label}\"\r\n| where currencyCode == \"{currency:value}\"\r\n| where location == \"{region:value}\"\r\n| project retailPrice",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "c71f3009-a3f4-4aa5-aaf0-d0f667100e56",
            "version": "KqlParameterItem/1.0",
            "name": "Help",
            "label": "Show Help",
            "type": 10,
            "description": "This will show some help information to help you understand the page you are on",
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n { \"value\": \"Yes\", \"label\": \"Yes\", \"selected\":true },\r\n { \"value\": \"No\", \"label\": \"No\"}\r\n]",
            "value": "No"
          },
          {
            "id": "4347fbc7-fdff-4238-bfbd-0c8105cb6c86",
            "version": "KqlParameterItem/1.0",
            "name": "changeLog",
            "label": "Change Log",
            "type": 10,
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n { \"value\": \"Yes\", \"label\": \"Yes\" },\r\n { \"value\": \"No\", \"label\": \"No\", \"selected\":true }\r\n]"
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - 1"
    },
    {
      "type": 1,
      "content": {
        "json": "### Change Log\r\n\r\n#### Version 1.6.2\r\n- Added additional descriptions for all fields\r\n- Added additional informational bubbles for parameters\r\n- Added Automatic cost calculation based on [external data](https://raw.githubusercontent.com/noodlemctwoodle/SentinelPublic/main/ExternalData/AllSentinelPrices.json) store in GitHub and updated automatically by [GitHub Actions](https://github.com/noodlemctwoodle/SentinelPublic/blob/main/.github/workflows/AllSentinelPrices.yml).\r\n- Added Basic Logs\r\n- Added Auxiliary Logs\r\n- Updated Commitment Tiers\r\n",
        "style": "info"
      },
      "conditionalVisibility": {
        "parameterName": "changeLog",
        "comparison": "isEqualTo",
        "value": "Yes"
      },
      "name": "text - 10"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "4df9243a-749d-4698-98f6-188e0b687e13",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "üîç Microsoft Sentinel",
            "subTarget": "Sentinel",
            "style": "link"
          },
          {
            "id": "ffceb6e6-3756-466e-860b-c017f0421e9f",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "üí∞ Microsoft Sentinel Benefits",
            "subTarget": "Benefits",
            "style": "link"
          },
          {
            "id": "f43799bc-9001-428d-a18b-b8be2df27a5e",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": " ü¶æ SOAR Cost",
            "subTarget": "SOAR",
            "style": "link"
          },
          {
            "id": "25b0dfdf-9de1-4a16-b66f-c5b3822c8018",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "üîí Commitment Tier",
            "subTarget": "Commitment",
            "style": "link"
          }
        ]
      },
      "name": "links - 19"
    },
    {
      "type": 1,
      "content": {
        "json": "# How to Use This Workbook\r\n\r\n### **Monitor and Control Costs**\r\nThis workbook is a powerful tool for managing and optimizing your Microsoft Sentinel costs. By regularly reviewing the data presented, you can:\r\n- Identify trends in data ingestion that could lead to unexpected cost increases.\r\n- Make decisions about data retention and ingestion policies to optimize spending.\r\n- Evaluate the effectiveness of your current data retention strategies and adjust them as needed.\r\n\r\n### **Optimize Data Retention**\r\nThe workbook provides visibility into how much data you are retaining and the costs associated with that retention. If you notice significant costs associated with data older than 90 days, consider whether this data is still necessary or if retention policies could be adjusted.\r\n\r\n### **Plan for the Future**\r\nBy understanding your average daily ingestion and cost breakdowns by log category, you can more accurately predict future costs and budget accordingly. This helps ensure that you are not caught off guard by unexpected charges.\r\n\r\n## Microsoft Sentinel PerGB (Pay as you go) Model\r\n\r\n### **Key Features**\r\n- **Flexible Pricing**: Charges are based on actual data ingested, allowing for cost management that reflects your organization's actual needs.\r\n- **Scalability**: Suitable for environments with variable log volumes, enabling you to scale your security operations without incurring unnecessary costs.\r\n- **Comprehensive Coverage**: Includes all the advanced security features of Microsoft Sentinel without requiring a long-term commitment.\r\n\r\n### **When to Use PerGB (Pay as you go)**\r\n- When your log volumes vary significantly.\r\n- If you prefer to avoid upfront commitments or fixed costs.\r\n- If you are just starting with Microsoft Sentinel and need to evaluate your data ingestion before moving to a reserved plan.\r\n\r\n## Additional Resources\r\n\r\nFor more detailed information, refer to the following links:\r\n- [Microsoft Sentinel Pricing Page](https://azure.microsoft.com/en-us/pricing/details/microsoft-sentinel/)\r\n- [Data Ingestion in Microsoft Sentinel](https://learn.microsoft.com/en-us/azure/sentinel/data-ingestion)\r\n- [Understanding Microsoft Sentinel Pricing](https://learn.microsoft.com/en-us/azure/sentinel/pricing)\r\n\r\nThis help file is intended to assist you in interpreting the visual data presented in your workbook and to make informed decisions about managing your Microsoft Sentinel costs. Regular use of this workbook will empower you to optimize your security operations while maintaining cost efficiency.",
        "style": "upsell"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "Help",
          "comparison": "isEqualTo",
          "value": "Yes"
        },
        {
          "parameterName": "selectedTab",
          "comparison": "isEqualTo",
          "value": "Sentinel"
        }
      ],
      "name": "text - 9"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Microsoft Sentinel Ingestion Summary (PAYG)"
            },
            "name": "text - 1"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "fec78265-6198-47fa-944d-8e1fc42b21d1",
                  "version": "KqlParameterItem/1.0",
                  "name": "skuName",
                  "label": "ü™¥ SKU Name",
                  "type": 2,
                  "description": "The Microsoft Sentinel ingestion SKU",
                  "isRequired": true,
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n  { \"value\": \"pay-as-you-go\", \"label\": \"Pay-as-you-go\", \"selected\": true },\r\n  { \"value\": \"100-gb-commitment-tier\", \"label\": \"100 GB Commitment Tier\" },\r\n  { \"value\": \"200-gb-commitment-tier\", \"label\": \"200 GB Commitment Tier\" },\r\n  { \"value\": \"300-gb-commitment-tier\", \"label\": \"300 GB Commitment Tier\" },\r\n  { \"value\": \"400-gb-commitment-tier\", \"label\": \"400 GB Commitment Tier\" },\r\n  { \"value\": \"500-gb-commitment-tier\", \"label\": \"500 GB Commitment Tier\" },\r\n  { \"value\": \"2000-gb-commitment-tier\", \"label\": \"2000 GB Commitment Tier\" },\r\n  { \"value\": \"5000-gb-commitment-tier\", \"label\": \"5000 GB Commitment Tier\" },\r\n  { \"value\": \"10000-gb-commitment-tier\", \"label\": \"10000 GB Commitment Tier\" },\r\n  { \"value\": \"25000-gb-commitment-tier\", \"label\": \"25000 GB Commitment Tier\" },\r\n  { \"value\": \"50000-gb-commitment-tier\", \"label\": \"50000 GB Commitment Tier\" }\r\n]"
                },
                {
                  "id": "206f147b-51b4-4773-a7e4-3473e7530231",
                  "version": "KqlParameterItem/1.0",
                  "name": "currencyCode",
                  "label": "üí± Currency",
                  "type": 2,
                  "description": "The currency you wish to view the workbook in",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n  { \"value\": \"GBP\", \"label\": \"Pound Stirling (¬£)\", \"selected\": true },\r\n  { \"value\": \"EUR\", \"label\": \"Euros (‚Ç¨)\" },\r\n  { \"value\": \"USD\", \"label\": \"United States Dollar ($)\" }\r\n]"
                },
                {
                  "id": "aab59f52-f31d-4c55-8020-aeb8e8980c3b",
                  "version": "KqlParameterItem/1.0",
                  "name": "location",
                  "label": "üåê Azure Region",
                  "type": 2,
                  "description": " The Azure region where your data is located",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n  { \"value\": \"AE Central\", \"label\": \"AE Central\" },\r\n  { \"value\": \"AE North\", \"label\": \"AE North\" },\r\n  { \"value\": \"AP East\", \"label\": \"AP East\" },\r\n  { \"value\": \"AP Southeast\", \"label\": \"AP Southeast\" },\r\n  { \"value\": \"AU Central\", \"label\": \"AU Central\" },\r\n  { \"value\": \"AU Central 2\", \"label\": \"AU Central 2\" },\r\n  { \"value\": \"AU East\", \"label\": \"AU East\" },\r\n  { \"value\": \"AU Southeast\", \"label\": \"AU Southeast\" },\r\n  { \"value\": \"BR South\", \"label\": \"BR South\" },\r\n  { \"value\": \"BR Southeast\", \"label\": \"BR Southeast\" },\r\n  { \"value\": \"CA Central\", \"label\": \"CA Central\" },\r\n  { \"value\": \"CA East\", \"label\": \"CA East\" },\r\n  { \"value\": \"CH North\", \"label\": \"CH North\" },\r\n  { \"value\": \"CH West\", \"label\": \"CH West\" },\r\n  { \"value\": \"DE North\", \"label\": \"DE North\" },\r\n  { \"value\": \"DE West Central\", \"label\": \"DE West Central\" },\r\n  { \"value\": \"ES Central\", \"label\": \"ES Central\" },\r\n  { \"value\": \"EU North\", \"label\": \"EU North\" },\r\n  { \"value\": \"EU West\", \"label\": \"EU West\" },\r\n  { \"value\": \"FR Central\", \"label\": \"FR Central\" },\r\n  { \"value\": \"FR South\", \"label\": \"FR South\" },\r\n  { \"value\": \"Global\", \"label\": \"Global\" },\r\n  { \"value\": \"IL Central\", \"label\": \"IL Central\" },\r\n  { \"value\": \"IN Central\", \"label\": \"IN Central\" },\r\n  { \"value\": \"IN Central Jio\", \"label\": \"IN Central Jio\" },\r\n  { \"value\": \"IN South\", \"label\": \"IN South\" },\r\n  { \"value\": \"IN West\", \"label\": \"IN West\" },\r\n  { \"value\": \"IN West Jio\", \"label\": \"IN West Jio\" },\r\n  { \"value\": \"IT North\", \"label\": \"IT North\" },\r\n  { \"value\": \"JA East\", \"label\": \"JA East\" },\r\n  { \"value\": \"JA West\", \"label\": \"JA West\" },\r\n  { \"value\": \"KR Central\", \"label\": \"KR Central\" },\r\n  { \"value\": \"KR South\", \"label\": \"KR South\" },\r\n  { \"value\": \"MX Central\", \"label\": \"MX Central\" },\r\n  { \"value\": \"NO East\", \"label\": \"NO East\" },\r\n  { \"value\": \"NO West\", \"label\": \"NO West\" },\r\n  { \"value\": \"PL Central\", \"label\": \"PL Central\" },\r\n  { \"value\": \"QA Central\", \"label\": \"QA Central\" },\r\n  { \"value\": \"SE Central\", \"label\": \"SE Central\" },\r\n  { \"value\": \"SE South\", \"label\": \"SE South\" },\r\n  { \"value\": \"UK South\", \"label\": \"UK South\", \"selected\": true },\r\n  { \"value\": \"UK West\", \"label\": \"UK West\" },\r\n  { \"value\": \"US Central\", \"label\": \"US Central\" },\r\n  { \"value\": \"US East\", \"label\": \"US East\" },\r\n  { \"value\": \"US East 2\", \"label\": \"US East 2\" },\r\n  { \"value\": \"US Gov AZ\", \"label\": \"US Gov AZ\" },\r\n  { \"value\": \"US Gov Virginia\", \"label\": \"US Gov Virginia\" },\r\n  { \"value\": \"US North Central\", \"label\": \"US North Central\" },\r\n  { \"value\": \"US South Central\", \"label\": \"US South Central\" },\r\n  { \"value\": \"US West\", \"label\": \"US West\" },\r\n  { \"value\": \"US West 2\", \"label\": \"US West 2\" },\r\n  { \"value\": \"US West 3\", \"label\": \"US West 3\" },\r\n  { \"value\": \"US West Central\", \"label\": \"US West Central\" },\r\n  { \"value\": \"ZA North\", \"label\": \"ZA North\" },\r\n  { \"value\": \"ZA West\", \"label\": \"ZA West\" }\r\n]"
                },
                {
                  "id": "0c448c7b-5dee-400c-baa5-a51e0de48794",
                  "version": "KqlParameterItem/1.0",
                  "name": "ingestionCost",
                  "label": "üíµ Ingestion Cost",
                  "type": 1,
                  "description": "Automantically calculated from the Azure region and Currency selection",
                  "query": "let jsonData = externaldata(\n    skuName:string,\n    unitOfMeasure:string,\n    type:string,\n    retailPrice:real,\n    unitPrice:real,\n    currencyCode:string,\n    location:string,\n    effectiveStartDate:datetime,\n    meterId:string,\n    meterName:string,\n    skuId:string,\n    productName:string,\n    serviceFamily:string\n)\n[\n    h@\"https://raw.githubusercontent.com/noodlemctwoodle/SentinelPublic/main/ExternalData/AllSentinelPrices.json\"\n]\nwith (format=\"multijson\");\njsonData\n| where skuName == \"{skuName:label}\"\n| where currencyCode == \"{currencyCode:value}\"\n| where location == \"{location:value}\"\n| project retailPrice",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 1"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union withsource=TableName1 * | where TimeGenerated < ago(90d) | extend key = 'Key' | summarize size = sum(_BilledSize)/1024/1024/1024 by key\r\n| project ['Data over 90 days'] = size, ['Retention Cost'] = size*{Retention}\r\n",
                    "size": 4,
                    "title": "Data older than 90 days and resulting retention cost",
                    "noDataMessage": "You have no data older than 90 days",
                    "noDataMessageStyle": 3,
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "33",
                  "name": "query - 0"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union withsource = tt *\r\n| where TimeGenerated > startofday({TimeRange:start}) and TimeGenerated < startofday({TimeRange:end})\r\n// Only look at chargeable Tables\r\n| where _IsBillable == True\r\n| summarize TotalGBytes =round(sum(_BilledSize/(1024*1024*1024)),2) by bin(TimeGenerated, 1d)//, Solution=tt\r\n| summarize ['GBs/day'] =round(avg(TotalGBytes),2)",
                    "size": 4,
                    "title": "Average billable GBs/day ingested in the last {TimeRange}",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "GBs/day",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "greenRed"
                        }
                      },
                      "showBorder": false,
                      "size": "auto"
                    }
                  },
                  "customWidth": "33",
                  "name": "query - 6"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| where IsBillable == true\r\n| summarize size = sum(Quantity)/1024 by IsBillable\r\n| project ['Total data ingestion'] = size, ['Estimated cost'] = size*{ingestionCost}",
                    "size": 4,
                    "title": "Total billable ingestion and cost in the last {TimeRange}",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "greenRed",
                          "compositeBarSettings": {
                            "labelText": ""
                          }
                        },
                        "numberFormat": {
                          "unit": 0,
                          "options": {
                            "currency": "USD",
                            "style": "currency",
                            "useGrouping": false
                          }
                        }
                      },
                      "leftContent": {
                        "columnMatch": "Total data ingestion",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "greenRed"
                        },
                        "numberFormat": {
                          "unit": 39,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      "rightContent": {
                        "columnMatch": "Estimated cost",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "greenRed"
                        },
                        "numberFormat": {
                          "unit": 0,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 1
                          }
                        }
                      },
                      "showBorder": false,
                      "size": "auto"
                    }
                  },
                  "customWidth": "33",
                  "name": "query - 8"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Categories = datatable(Type:string,Category:string)\r\n[\r\n\"AuditLogs\" , \"Azure Active Directory\",\r\n\"SigninLogs\" , \"Azure Active Directory\",\r\n\"AADNonInteractiveUserSignInLogs\" , \"Azure Active Directory\",\r\n\"AADRiskyUsers\" , \"Azure Active Directory\",\r\n\"AADRiskyServicePrincipals\" , \"Azure Active Directory\",\r\n\"AADServicePrincipalRiskEvents\" , \"Azure Active Directory\",\r\n\"ADFSSignInLogs\" , \"Azure Active Directory\",\r\n\"NetworkAccessTraffic\" , \"Azure Active Directory\",\r\n\"AADUserRiskEvents\" , \"Azure Active Directory\",\r\n\"AADServicePrincipalSignInLogs\" , \"Azure Active Directory\",\r\n\"AADManagedIdentitySignInLogs\" , \"Azure Active Directory\",\r\n\"AADProvisioningLogs\" , \"Azure Active Directory\",\r\n\"AZFWApplicationRule\" , \"Firewall\",\r\n\"AZFWApplicationRuleAggregation\" , \"Firewall\",\r\n\"AZFWDnsQuery\" , \"Firewall\",\r\n\"AZFWIdpsSignature\" , \"Firewall\",\r\n\"AZFWNatRule\" , \"Firewall\",\r\n\"AZFWNatRuleAggregation\" , \"Firewall\",\r\n\"AZFWNetworkRule\" , \"Firewall\",\r\n\"AZFWNetworkRuleAggregation\" , \"Firewall\",\r\n\"WindowsFirewall\" , \"Firewall\",\r\n\"Event\" , \"Custom Events\",\r\n\"BehaviorAnalytics\" , \"User Entity Behavior Analytics\",\r\n\"UserPeerAnalytics\" , \"User Entity Behavior Analytics\",\r\n\"UserAccessAnalytics\" , \"User Entity Behavior Analytics\",\r\n\"IdentityInfo\" , \"User Entity Behavior Analytics\",\r\n\"DeviceLogonEvents\" , \"Microsoft Defender for Endpoint\",\r\n\"DeviceEvents\" , \"Microsoft Defender for Endpoint\",\r\n\"DeviceNetworkInfo\" , \"Microsoft Defender for Endpoint\",\r\n\"DeviceImageLoadEvents\" , \"Microsoft Defender for Endpoint\",\r\n\"DeviceFileEvents\" , \"Microsoft Defender for Endpoint\",\r\n\"DeviceInfo\" , \"Microsoft Defender for Endpoint\",\r\n\"DeviceProcessEvents\" , \"Microsoft Defender for Endpoint\",\r\n\"DeviceNetworkEvents\" , \"Microsoft Defender for Endpoint\",\r\n\"DeviceRegistryEvents\" , \"Microsoft Defender for Endpoint\",\r\n\"DeviceFileCertificateInfo\" , \"Microsoft Defender for Endpoint\",\r\n\"EmailAttachmentInfo\" , \"Microsoft Defender for Office 365\",\r\n\"EmailEvents\" , \"Microsoft Defender for Office 365\",\r\n\"EmailPostDeliveryEvents\" , \"Microsoft Defender for Office 365\",\r\n\"EmailUrlInfo\" , \"Microsoft Defender for Office 365\",\r\n\"IdentityLogonEvents\" , \"Microsoft Defender for Identity\",\r\n\"IdentityQueryEvents\" , \"Microsoft Defender for Identity\",\r\n\"IdentityDirectoryEvents\" , \"Microsoft Defender for Identity\",\r\n\"CloudAppEvents\" , \"Microsoft Defender for Cloud Apps\",\r\n\"AlertEvidence\" , \"Microsoft Defender Alert Evidence\",\r\n\"InsightsMetrics\" , \"Azure Monitor for VMs\",\r\n\"VMBoundPort\" , \"Azure Monitor for VMs\",\r\n\"VMComputer\" , \"Azure Monitor for VMs\",\r\n\"VMConnection\" , \"Azure Monitor for VMs\",\r\n\"VMProcess\" , \"Azure Monitor for VMs\",\r\n\"SecurityEvent\" , \"Windows Security Events\",\r\n\"StorageBlobLogs\" , \"Azure Storage\",\r\n\"StorageFileLogs\" , \"Azure Storage\",\r\n\"Syslog\" , \"Syslog/CEF\",\r\n\"SecurityIoTRawEvent\" , \"IoT Logs\",\r\n\"CommonSecurityLog\" , \"Syslog/CEF\",\r\n\"ThreatIntelligenceIndicator\" , \"Sentinel\",\r\n\"DnsEvents\" , \"DNS Logs\",\r\n\"DnsInventory\" , \"DNS Logs\",\r\n\"AWSCloudTrail\" , \"AWS Logs\",\r\n\"AWSVPCFlow\" , \"AWS Logs\",\r\n\"ConfigurationChange\" , \"Change Tracking\",\r\n\"ConfigurationData\" , \"Change Tracking\",\r\n\"AzureDiagnostics\" , \"Azure Resources\",\r\n\"AzureActivity\" , \"Azure Resources\",\r\n\"LAQueryLogs\" , \"Management\",\r\n\"SentinelHealth\" , \"Sentinel\",\r\n\"Perf\" , \"Performance\",\r\n\"AzureMetrics\" , \"Azure Metrics\",\r\n\"SecurityNestedRecommendation\" , \"Microsoft Defender for Cloud\",\r\n\"SecurityRecommendation\" , \"Microsoft Defender for Cloud\",\r\n\"SecurityRegulatoryCompliance\" , \"Microsoft Defender for Cloud\",\r\n\"SecureScoreControls\" , \"Microsoft Defender for Cloud\",\r\n\"SecurityBaseline\" , \"Microsoft Defender for Cloud\",\r\n\"SecureScores\" , \"Microsoft Defender for Cloud\",\r\n\"Update\" , \"Update Management\",\r\n\"UpdateSummary\" , \"Update Management\",\r\n\"DeviceTvmSecureConfigurationAssessment\" , \"Microsoft Defender Vuln. Management\",\r\n\"DeviceTvmSoftwareVulnerabilities\" , \"Microsoft Defender Vuln. Management\",\r\n\"DeviceTvmSoftwareInventory\" , \"Microsoft Defender Vuln. Management\",\r\n\"UrlClickEvents\" , \"Microsoft Defender for Office 365\",\r\n\"SecurityBaselineSummary\" , \"Microsoft Defender for Cloud\",\r\n\"AZFWThreatIntel\" , \"Firewall\",\r\n\"AWSGuardDuty\" , \"AWS Logs\",\r\n\"Watchlist\" , \"Sentinel\",\r\n\"HuntingBookmark\" , \"Sentinel\",\r\n\"SentinelAudit\" , \"Sentinel\",\r\n\"Operation\" , \"Log Management\",\r\n\"StorageTableLogs\" , \"Azure Storage\",\r\n\"AddonAzureBackupStorage\" , \"Azure Storage\",\r\n\"AddonAzureBackupPolicy\" , \"Azure Storage\",\r\n\"StorageQueueLogs\" , \"Azure Storage\",\r\n\"AddonAzureBackupProtectedInstance\" , \"Azure Storage\",\r\n\"AddonAzureBackupJobs\" , \"Azure Storage\"\r\n];\r\nlet customTables = Usage\r\n| where IsBillable == true\r\n| where DataType contains \"_CL\"\r\n| summarize size = sum(Quantity)/1024 by DataType\r\n| project ['Log Type'] = \"Custom Log\",['Table'] = DataType, ['Table Size'] = size, ['Estimated cost'] = size*{ingestionCost};\r\nlet AzDiagTables = AzureDiagnostics\r\n| summarize TotalIngestBytes=sum(_BilledSize) by Category\r\n| project ['Log Type'] = \"AzureDiagnostics\", ['Table'] = Category ,['Table Size'] = TotalIngestBytes/1024000000 , ['Estimated cost'] = (TotalIngestBytes/1024000000 ) * {ingestionCost};\r\nlet knownTables = Usage\r\n| where IsBillable == true \r\n| where DataType <> \"AzureDiagnostics\"\r\n| join kind=leftouter Categories on $left.DataType == $right.Type\r\n| summarize size =sumif(Quantity, isnotempty(Category))/1024, sizeOther= sumif(Quantity,(isempty(Category) and DataType !contains \"_CL\"))/1024 by Category, DataType\r\n| project ['Log Type'] = iif(isnotempty( Category),Category,\"Other\"), ['Table'] = DataType, ['Table Size'] = iif(isnotempty( Category),size,sizeOther), ['Estimated cost'] = iif(isnotempty(Category),size*{ingestionCost},sizeOther*{ingestionCost});\r\nunion customTables, knownTables, AzDiagTables\r\n| sort by ['Estimated cost'] desc",
                    "size": 2,
                    "title": "Breakdown of billable ingestion by log category in the last {TimeRange}",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table Size",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 39,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Estimated cost",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Group",
                          "formatter": 1
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "Log Type"
                        ],
                        "finalBy": "Table"
                      },
                      "sortBy": [
                        {
                          "itemKey": "$gen_count_$gen_group_0",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_count_$gen_group_0",
                        "sortOrder": 1
                      }
                    ],
                    "graphSettings": {
                      "type": 0,
                      "topContent": {
                        "columnMatch": "Log Category",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "Billed Size",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "name": "query - 2"
                }
              ]
            },
            "customWidth": "70",
            "name": "group - CostData"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# Overview\r\n\r\nThis workbook is designed to provide you with insights into your data ingestion and associated costs within Microsoft Sentinel, particularly under the PerGB (Pay as you go) pricing model. It visualizes key metrics related to the amount of data you're ingesting, the age of the data, and the estimated costs associated with retaining and analyzing this data.\r\n\r\n## Visualizations in the Workbook\r\n\r\n### 1. **Data Older Than 90 Days and Retention Cost**\r\n   - **What You Are Seeing**: This chart displays the amount of data that is older than 90 days and calculates the cost associated with retaining this data.\r\n   - **Why It Matters**: Data retention beyond 90 days can incur additional costs. This visualization helps you understand how much of your data falls into this category and the potential cost implications.\r\n\r\n### 2. **Average Billable GBs/Day Ingested in the Last TimeRange**\r\n   - **What You Are Seeing**: This tile shows the average amount of billable data ingested per day over a specified time range.\r\n   - **Why It Matters**: Monitoring the daily average of data ingestion helps you track trends and predict future costs, ensuring you stay within budget or identify periods of high usage that may require further analysis.\r\n\r\n### 3. **Total Billable Ingestion and Cost in the Last TimeRange**\r\n   - **What You Are Seeing**: This visualization provides a summary of the total amount of billable data ingested during a specified time range and the estimated costs associated with this ingestion.\r\n   - **Why It Matters**: This helps you understand the overall cost implications of your data ingestion, allowing you to manage and optimize your spending more effectively.\r\n\r\n### 4. **Breakdown of Billable Ingestion by Log Category in the Last TimeRange**\r\n   - **What You Are Seeing**: This table breaks down your data ingestion by log category, showing the amount of data ingested and the associated cost for each log type.\r\n   - **Why It Matters**: Different log categories may have varying levels of importance or cost. By seeing which categories contribute most to your ingestion volume and costs, you can make informed decisions about which logs to prioritize or potentially reduce.",
                    "style": "upsell"
                  },
                  "name": "text-BasicLogs"
                }
              ]
            },
            "customWidth": "30",
            "conditionalVisibility": {
              "parameterName": "Help",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "group - CostHelp"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Sentinel"
      },
      "name": "group - Microsoft Sentinel",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Basic Logs"
            },
            "name": "text - 2"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "fec78265-6198-47fa-944d-8e1fc42b21d1",
                  "version": "KqlParameterItem/1.0",
                  "name": "skuName",
                  "label": "ü™¥ SKU Name",
                  "type": 2,
                  "description": "The Microsoft Sentinel Basic Logs SKU",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n  { \"value\": \"basic-logs\", \"label\": \"Basic Logs\", \"selected\": true }\r\n]"
                },
                {
                  "id": "206f147b-51b4-4773-a7e4-3473e7530231",
                  "version": "KqlParameterItem/1.0",
                  "name": "currencyCode",
                  "label": "üí± Currency",
                  "type": 2,
                  "description": "The currency you wish to view the workbook in",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n  { \"value\": \"GBP\", \"label\": \"Pound Stirling (¬£)\", \"selected\": true },\r\n  { \"value\": \"EUR\", \"label\": \"Euro (‚Ç¨)\" },\r\n  { \"value\": \"USD\", \"label\": \"United States Dollar ($)\" }\r\n]"
                },
                {
                  "id": "aab59f52-f31d-4c55-8020-aeb8e8980c3b",
                  "version": "KqlParameterItem/1.0",
                  "name": "location",
                  "label": "üåê Azure Region",
                  "type": 2,
                  "description": "The Azure region where your data is located",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n  { \"value\": \"AE Central\", \"label\": \"AE Central\" },\r\n  { \"value\": \"AE North\", \"label\": \"AE North\" },\r\n  { \"value\": \"AP East\", \"label\": \"AP East\" },\r\n  { \"value\": \"AP Southeast\", \"label\": \"AP Southeast\" },\r\n  { \"value\": \"AU Central\", \"label\": \"AU Central\" },\r\n  { \"value\": \"AU Central 2\", \"label\": \"AU Central 2\" },\r\n  { \"value\": \"AU East\", \"label\": \"AU East\" },\r\n  { \"value\": \"AU Southeast\", \"label\": \"AU Southeast\" },\r\n  { \"value\": \"BR South\", \"label\": \"BR South\" },\r\n  { \"value\": \"BR Southeast\", \"label\": \"BR Southeast\" },\r\n  { \"value\": \"CA Central\", \"label\": \"CA Central\" },\r\n  { \"value\": \"CA East\", \"label\": \"CA East\" },\r\n  { \"value\": \"CH North\", \"label\": \"CH North\" },\r\n  { \"value\": \"CH West\", \"label\": \"CH West\" },\r\n  { \"value\": \"DE North\", \"label\": \"DE North\" },\r\n  { \"value\": \"DE West Central\", \"label\": \"DE West Central\" },\r\n  { \"value\": \"ES Central\", \"label\": \"ES Central\" },\r\n  { \"value\": \"EU North\", \"label\": \"EU North\" },\r\n  { \"value\": \"EU West\", \"label\": \"EU West\" },\r\n  { \"value\": \"FR Central\", \"label\": \"FR Central\" },\r\n  { \"value\": \"FR South\", \"label\": \"FR South\" },\r\n  { \"value\": \"Global\", \"label\": \"Global\" },\r\n  { \"value\": \"IL Central\", \"label\": \"IL Central\" },\r\n  { \"value\": \"IN Central\", \"label\": \"IN Central\" },\r\n  { \"value\": \"IN Central Jio\", \"label\": \"IN Central Jio\" },\r\n  { \"value\": \"IN South\", \"label\": \"IN South\" },\r\n  { \"value\": \"IN West\", \"label\": \"IN West\" },\r\n  { \"value\": \"IN West Jio\", \"label\": \"IN West Jio\" },\r\n  { \"value\": \"IT North\", \"label\": \"IT North\" },\r\n  { \"value\": \"JA East\", \"label\": \"JA East\" },\r\n  { \"value\": \"JA West\", \"label\": \"JA West\" },\r\n  { \"value\": \"KR Central\", \"label\": \"KR Central\" },\r\n  { \"value\": \"KR South\", \"label\": \"KR South\" },\r\n  { \"value\": \"MX Central\", \"label\": \"MX Central\" },\r\n  { \"value\": \"NO East\", \"label\": \"NO East\" },\r\n  { \"value\": \"NO West\", \"label\": \"NO West\" },\r\n  { \"value\": \"PL Central\", \"label\": \"PL Central\" },\r\n  { \"value\": \"QA Central\", \"label\": \"QA Central\" },\r\n  { \"value\": \"SE Central\", \"label\": \"SE Central\" },\r\n  { \"value\": \"SE South\", \"label\": \"SE South\" },\r\n  { \"value\": \"UK South\", \"label\": \"UK South\", \"selected\": true },\r\n  { \"value\": \"UK West\", \"label\": \"UK West\" },\r\n  { \"value\": \"US Central\", \"label\": \"US Central\" },\r\n  { \"value\": \"US East\", \"label\": \"US East\" },\r\n  { \"value\": \"US East 2\", \"label\": \"US East 2\" },\r\n  { \"value\": \"US Gov AZ\", \"label\": \"US Gov AZ\" },\r\n  { \"value\": \"US Gov Virginia\", \"label\": \"US Gov Virginia\" },\r\n  { \"value\": \"US North Central\", \"label\": \"US North Central\" },\r\n  { \"value\": \"US South Central\", \"label\": \"US South Central\" },\r\n  { \"value\": \"US West\", \"label\": \"US West\" },\r\n  { \"value\": \"US West 2\", \"label\": \"US West 2\" },\r\n  { \"value\": \"US West 3\", \"label\": \"US West 3\" },\r\n  { \"value\": \"US West Central\", \"label\": \"US West Central\" },\r\n  { \"value\": \"ZA North\", \"label\": \"ZA North\" },\r\n  { \"value\": \"ZA West\", \"label\": \"ZA West\" }\r\n]"
                },
                {
                  "id": "0c448c7b-5dee-400c-baa5-a51e0de48794",
                  "version": "KqlParameterItem/1.0",
                  "name": "basicLogsCost",
                  "label": "üíµ Ingestion Cost",
                  "type": 1,
                  "description": "Automantically calculated from the Azure region and Currency selection",
                  "query": "let jsonData = externaldata(\n    skuName:string,\n    unitOfMeasure:string,\n    type:string,\n    retailPrice:real,\n    unitPrice:real,\n    currencyCode:string,\n    location:string,\n    effectiveStartDate:datetime,\n    meterId:string,\n    meterName:string,\n    skuId:string,\n    productName:string,\n    serviceFamily:string\n)\n[\n    h@\"https://raw.githubusercontent.com/noodlemctwoodle/SentinelPublic/main/ExternalData/AllSentinelPrices.json\"\n]\nwith (format=\"multijson\");\njsonData\n| where skuName == \"{skuName:label}\"\n| where currencyCode == \"{currencyCode:value}\"\n| where location == \"{location:value}\"\n| project retailPrice",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "8afeee67-b32f-4e37-8190-f57d3196ba0c",
                  "version": "KqlParameterItem/1.0",
                  "name": "BasicTables",
                  "type": 1,
                  "description": "Basic Log Tables",
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourcegroups/{Workspace:resourcegroup}/providers/microsoft.operationalinsights/workspaces/{Workspace:name}/tables?api-version=2021-12-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.properties.plan==\\\"Basic\\\")]\",\"columns\":[{\"path\":\"name\",\"columnid\":\"Name\",\"columnType\":\"string\"}]}}]}",
                  "isHiddenWhenLocked": true,
                  "queryType": 12
                }
              ],
              "style": "above",
              "queryType": 12
            },
            "name": "parameters - 1"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| take 1\r\n| extend Basic = \"{BasicTables}\"\r\n| extend Basic = substring(Basic, 1,strlen(Basic)-2)\r\n| project BasicLogs_Table=split(Basic, ',')\r\n| mv-expand BasicLogs_Table\r\n| where isnotempty(BasicLogs_Table)\r\n| count\r\n| extend Title = \"Total Basic Logs Table\"\r\n| extend Text = \"in {Workspace:Label} workspace\"\r\n",
                    "size": 4,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Title"
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 12,
                        "formatOptions": {
                          "min": -1,
                          "palette": "blue"
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "Text",
                        "formatter": 1
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "70",
                  "name": "query-TotalBasicLogs"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourcegroups/{Workspace:resourcegroup}/providers/microsoft.operationalinsights/workspaces/{Workspace:name}/tables?api-version=2021-12-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.properties.plan==\\\"Basic\\\")]\",\"columns\":[{\"path\":\"name\",\"columnid\":\"TableName\",\"columnType\":\"string\"},{\"path\":\"$..properties.schema.tableType\",\"columnid\":\"TableType\",\"columnType\":\"string\"},{\"path\":\"$..properties.totalRetentionInDays\",\"columnid\":\"TotalRetentionInDays\",\"columnType\":\"long\"},{\"path\":\"$..properties.retentionInDays\",\"columnid\":\"InteractiveRetentionInDays\",\"columnType\":\"long\"},{\"path\":\"$..properties.archiveRetentionInDays\",\"columnid\":\"ArchiveRetentionInDays\",\"columnType\":\"long\"}]}}]}",
                    "size": 1,
                    "title": "Basic Logs Table",
                    "noDataMessage": "Currently no Basic Logs being configured",
                    "queryType": 12,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TableName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "TableType",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Microsoft",
                                "representation": "brown",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "CustomLog",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "14ch"
                          }
                        },
                        {
                          "columnMatch": "TotalRetentionInDays",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "palette": "turquoise",
                            "customColumnWidthSetting": "24ch"
                          }
                        },
                        {
                          "columnMatch": "InteractiveRetentionInDays",
                          "formatter": 8,
                          "formatOptions": {
                            "min": -180,
                            "max": 730,
                            "palette": "purpleBlue",
                            "customColumnWidthSetting": "28ch"
                          }
                        },
                        {
                          "columnMatch": "ArchiveRetentionInDays",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 700,
                            "palette": "purpleDark",
                            "customColumnWidthSetting": "26ch"
                          }
                        }
                      ]
                    }
                  },
                  "name": "query-BasicLogsTable"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| where StartTime {TimeRange:value}\r\n| where IsBillable == 'true'\r\n| summarize ['Table Size'] =sum(Quantity) by DataType\r\n| order by ['Table Size']  desc\r\n| join kind= leftouter (\r\nUsage\r\n| where StartTime {TimeRange:value}\r\n| where IsBillable == 'true'\r\n| make-series IngestionTrend = sum(Quantity) default =0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DataType\r\n) on DataType\r\n| project-away DataType1, TimeGenerated",
                    "size": 1,
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "test",
                    "comparison": "isEqualTo",
                    "value": "1"
                  },
                  "name": "query-BasicLogsSizeTemp"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Select the Basic Log tables to calculate the cost",
                    "style": "info"
                  },
                  "name": "text - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"315f272c-1d92-42a4-80a9-ea0c855272ad\",\"mergeType\":\"leftouter\",\"leftTable\":\"query-BasicLogsTable\",\"rightTable\":\"query-BasicLogsSizeTemp\",\"leftColumn\":\"TableName\",\"rightColumn\":\"DataType\"}],\"projectRename\":[{\"originalName\":\"[query-BasicLogsTable].TableName\",\"mergedName\":\"TableName\",\"fromId\":\"315f272c-1d92-42a4-80a9-ea0c855272ad\"},{\"originalName\":\"[query-BasicLogsSizeTemp].Table Size\",\"mergedName\":\"Table Size\",\"fromId\":\"315f272c-1d92-42a4-80a9-ea0c855272ad\"},{\"originalName\":\"[query-BasicLogsSizeTemp].IngestionTrend\",\"mergedName\":\"IngestionTrend\",\"fromId\":\"315f272c-1d92-42a4-80a9-ea0c855272ad\"},{\"originalName\":\"[query-BasicLogsTable].TableType\"},{\"originalName\":\"[query-BasicLogsTable].TotalRetentionInDays\"},{\"originalName\":\"[query-BasicLogsTable].InteractiveRetentionInDays\"},{\"originalName\":\"[query-BasicLogsTable].ArchiveRetentionInDays\"},{\"originalName\":\"[query-BasicLogsSizeTemp].DataType\"}]}",
                    "size": 1,
                    "title": "Basic Logs Table Size, from: {TimeRange:label} data",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "TableName",
                        "parameterName": "basicTableName",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 7,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table Size",
                          "formatter": 3,
                          "formatOptions": {
                            "min": 0,
                            "palette": "greenRed",
                            "customColumnWidthSetting": "240px"
                          },
                          "numberFormat": {
                            "unit": 38,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "IngestionTrend",
                          "formatter": 9,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue"
                          }
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "BasicTables",
                    "comparison": "isNotEqualTo"
                  },
                  "showPin": false,
                  "name": "query-BasicLogsMerge"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| where IsBillable == true\r\n| where DataType has_any ({basicTableName})\r\n| summarize size = sum(Quantity)/1024 by DataType\r\n| project ['Log Type'] = \"Custom Log\",['Table'] = DataType, ['Table Size'] = size, ['Estimated cost'] = size*{basicLogsCost};",
                    "size": 1,
                    "title": "Basic Logs Cost",
                    "noDataMessage": "No Data Selected",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "conditionalVisibility": {
                    "parameterName": "basicTableName",
                    "comparison": "isNotEqualTo",
                    "value": ""
                  },
                  "name": "query - 8"
                }
              ]
            },
            "customWidth": "70",
            "name": "group - BasicLogsData"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### Basic Logs ###\r\n\r\nIn this section, you will be presented with a list of Basic Logs tables configured in your workspace (if any). \r\n\r\nThere might be logs in your environment that generate a large volume of verbose data, but contain relatively limited security detection value. These logs can be needed for threat hunt, audit or compliance purposes but often not critical for deep analytics and alerts.\r\n\r\n**Basic Logs** is a cost-effective data plan that provides a lower cost option for ingestion of high-volume verbose logs without the full capabilities of analytics logs.\r\nBasic Logs will be accessible for interactive queries for the first 8 days. \r\nAfterwards [archived logs](https://learn.microsoft.com/azure/azure-monitor/logs/data-retention-archive?tabs=portal-1%2Cportal-2) can be enabled to store the data. Before configuring tables as Basic Logs, [compare log data plans](https://learn.microsoft.com/azure/azure-monitor/logs/basic-logs-configure?tabs=portal-1#compare-the-basic-and-analytics-log-data-plans) to find out more about the offering and differences between Basic Logs and default Analytics Logs.\r\n\r\n<br>\r\n**When should I use Basic logs?**\r\n\r\nBy default, all tables in your Log Analytics workspace are Analytics tables, and they're available for query and alerts.\r\n\r\nConfigure a table for Basic logs if:\r\n\r\n- You don't require more than eight days of data retention for the table.\r\n\r\n- You only require basic queries of the data using a [limited version of the query language](https://learn.microsoft.com/azure/azure-monitor/logs/basic-logs-query?tabs=portal-1#limitations).\r\n\r\n- The cost savings for data ingestion exceed the expected cost for any expected queries.\r\n\r\n<br>\r\n**For more information**, refer to the following links:\r\n\r\n\r\n- [Basic Logs use cases](https://learn.microsoft.com/azure/sentinel/basic-logs-use-cases)\r\n\r\n- [The table that supports Basic logs](https://learn.microsoft.com/azure/azure-monitor/logs/basic-logs-configure?tabs=portal-1#when-should-i-use-basic-logs)\r\n\r\n- [How to set a table's log data plan to Basic or Analytics](https://learn.microsoft.com/azure/azure-monitor/logs/basic-logs-configure?tabs=portal-1#set-a-tables-log-data-plan)\r\n\r\n- [Microsoft Sentinel Pricing Page](https://azure.microsoft.com/pricing/details/microsoft-sentinel/)\r\n",
                    "style": "upsell"
                  },
                  "name": "text-BasicLogs"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "2b8f0ca5-1278-4ea2-a851-94c61372a1a4",
                        "cellValue": "",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Open Tables page",
                        "subTarget": "test",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "TablesBlade",
                          "extensionName": "Microsoft_OperationsManagementSuite_Workspace",
                          "bladeParameters": [
                            {
                              "name": "workspaceResourceId",
                              "source": "static",
                              "value": "{Workspace:id}"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "name": "links-OpenRestoration"
                }
              ]
            },
            "customWidth": "30",
            "conditionalVisibility": {
              "parameterName": "Help",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "group - BasicLogsHelp"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Sentinel"
      },
      "name": "group-BasicLogs",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Auxilary Logs"
            },
            "name": "text - 2"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "fec78265-6198-47fa-944d-8e1fc42b21d1",
                  "version": "KqlParameterItem/1.0",
                  "name": "skuName",
                  "label": "ü™¥ SKU Name",
                  "type": 2,
                  "description": "The Microsoft Sentinel ingestion SKU",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n  { \"value\": \"auxiliary-logs-analysis\", \"label\": \"Auxiliary Logs Analysis\", \"selected\": true}\r\n]"
                },
                {
                  "id": "206f147b-51b4-4773-a7e4-3473e7530231",
                  "version": "KqlParameterItem/1.0",
                  "name": "currencyCode",
                  "label": "üí± Currency",
                  "type": 2,
                  "description": "The currency you wish to view the workbook in",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n  { \"value\": \"GBP\", \"label\": \"Pound Stirling (¬£)\", \"selected\": true },\r\n  { \"value\": \"EUR\", \"label\": \"Euro (‚Ç¨)\" },\r\n  { \"value\": \"USD\", \"label\": \"United States Dollar ($)\" }\r\n]"
                },
                {
                  "id": "aab59f52-f31d-4c55-8020-aeb8e8980c3b",
                  "version": "KqlParameterItem/1.0",
                  "name": "location",
                  "label": "üåê Azure Region",
                  "type": 2,
                  "description": "The Azure region where your data is located",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n  { \"value\": \"AE Central\", \"label\": \"AE Central\" },\r\n  { \"value\": \"AE North\", \"label\": \"AE North\" },\r\n  { \"value\": \"AP East\", \"label\": \"AP East\" },\r\n  { \"value\": \"AP Southeast\", \"label\": \"AP Southeast\" },\r\n  { \"value\": \"AU Central\", \"label\": \"AU Central\" },\r\n  { \"value\": \"AU Central 2\", \"label\": \"AU Central 2\" },\r\n  { \"value\": \"AU East\", \"label\": \"AU East\" },\r\n  { \"value\": \"AU Southeast\", \"label\": \"AU Southeast\" },\r\n  { \"value\": \"BR South\", \"label\": \"BR South\" },\r\n  { \"value\": \"BR Southeast\", \"label\": \"BR Southeast\" },\r\n  { \"value\": \"CA Central\", \"label\": \"CA Central\" },\r\n  { \"value\": \"CA East\", \"label\": \"CA East\" },\r\n  { \"value\": \"CH North\", \"label\": \"CH North\" },\r\n  { \"value\": \"CH West\", \"label\": \"CH West\" },\r\n  { \"value\": \"DE North\", \"label\": \"DE North\" },\r\n  { \"value\": \"DE West Central\", \"label\": \"DE West Central\" },\r\n  { \"value\": \"ES Central\", \"label\": \"ES Central\" },\r\n  { \"value\": \"EU North\", \"label\": \"EU North\" },\r\n  { \"value\": \"EU West\", \"label\": \"EU West\" },\r\n  { \"value\": \"FR Central\", \"label\": \"FR Central\" },\r\n  { \"value\": \"FR South\", \"label\": \"FR South\" },\r\n  { \"value\": \"Global\", \"label\": \"Global\" },\r\n  { \"value\": \"IL Central\", \"label\": \"IL Central\" },\r\n  { \"value\": \"IN Central\", \"label\": \"IN Central\" },\r\n  { \"value\": \"IN Central Jio\", \"label\": \"IN Central Jio\" },\r\n  { \"value\": \"IN South\", \"label\": \"IN South\" },\r\n  { \"value\": \"IN West\", \"label\": \"IN West\" },\r\n  { \"value\": \"IN West Jio\", \"label\": \"IN West Jio\" },\r\n  { \"value\": \"IT North\", \"label\": \"IT North\" },\r\n  { \"value\": \"JA East\", \"label\": \"JA East\" },\r\n  { \"value\": \"JA West\", \"label\": \"JA West\" },\r\n  { \"value\": \"KR Central\", \"label\": \"KR Central\" },\r\n  { \"value\": \"KR South\", \"label\": \"KR South\" },\r\n  { \"value\": \"MX Central\", \"label\": \"MX Central\" },\r\n  { \"value\": \"NO East\", \"label\": \"NO East\" },\r\n  { \"value\": \"NO West\", \"label\": \"NO West\" },\r\n  { \"value\": \"PL Central\", \"label\": \"PL Central\" },\r\n  { \"value\": \"QA Central\", \"label\": \"QA Central\" },\r\n  { \"value\": \"SE Central\", \"label\": \"SE Central\" },\r\n  { \"value\": \"SE South\", \"label\": \"SE South\" },\r\n  { \"value\": \"UK South\", \"label\": \"UK South\", \"selected\": true },\r\n  { \"value\": \"UK West\", \"label\": \"UK West\" },\r\n  { \"value\": \"US Central\", \"label\": \"US Central\" },\r\n  { \"value\": \"US East\", \"label\": \"US East\" },\r\n  { \"value\": \"US East 2\", \"label\": \"US East 2\" },\r\n  { \"value\": \"US Gov AZ\", \"label\": \"US Gov AZ\" },\r\n  { \"value\": \"US Gov Virginia\", \"label\": \"US Gov Virginia\" },\r\n  { \"value\": \"US North Central\", \"label\": \"US North Central\" },\r\n  { \"value\": \"US South Central\", \"label\": \"US South Central\" },\r\n  { \"value\": \"US West\", \"label\": \"US West\" },\r\n  { \"value\": \"US West 2\", \"label\": \"US West 2\" },\r\n  { \"value\": \"US West 3\", \"label\": \"US West 3\" },\r\n  { \"value\": \"US West Central\", \"label\": \"US West Central\" },\r\n  { \"value\": \"ZA North\", \"label\": \"ZA North\" },\r\n  { \"value\": \"ZA West\", \"label\": \"ZA West\" }\r\n]"
                },
                {
                  "id": "0c448c7b-5dee-400c-baa5-a51e0de48794",
                  "version": "KqlParameterItem/1.0",
                  "name": "auxiliaryCost",
                  "label": "üíµ Ingestion Cost",
                  "type": 1,
                  "description": "Automantically calculated from the Azure region and Currency selection",
                  "query": "let jsonData = externaldata(\n    skuName:string,\n    unitOfMeasure:string,\n    type:string,\n    retailPrice:real,\n    unitPrice:real,\n    currencyCode:string,\n    location:string,\n    effectiveStartDate:datetime,\n    meterId:string,\n    meterName:string,\n    skuId:string,\n    productName:string,\n    serviceFamily:string\n)\n[\n    h@\"https://raw.githubusercontent.com/noodlemctwoodle/SentinelPublic/main/ExternalData/AllSentinelPrices.json\"\n]\nwith (format=\"multijson\");\njsonData\n| where skuName == \"{skuName:label}\"\n| where currencyCode == \"{currencyCode:value}\"\n| where location == \"{location:value}\"\n| project retailPrice",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "8afeee67-b32f-4e37-8190-f57d3196ba0c",
                  "version": "KqlParameterItem/1.0",
                  "name": "AuxiliaryTables",
                  "type": 1,
                  "description": "Auxiliary Log Tables",
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourcegroups/{Workspace:resourcegroup}/providers/microsoft.operationalinsights/workspaces/{Workspace:name}/tables?api-version=2021-12-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.properties.plan==\\\"Auxiliary\\\")]\",\"columns\":[{\"path\":\"name\",\"columnid\":\"Name\",\"columnType\":\"string\"}]}}]}",
                  "isHiddenWhenLocked": true,
                  "queryType": 12
                }
              ],
              "style": "above",
              "queryType": 12
            },
            "name": "parameters - 1"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| take 1\r\n| extend Auxiliary = \"{AuxiliaryTables}\"\r\n| extend Auxiliary = substring(Auxiliary, 1,strlen(Auxiliary)-2)\r\n| project AuxiliaryLogs_Table=split(Auxiliary, ',')\r\n| mv-expand AuxiliaryLogs_Table\r\n| where isnotempty(AuxiliaryLogs_Table)\r\n| count\r\n| extend Title = \"Total Auxiliary Logs Table\"\r\n| extend Text = \"in {Workspace:Label} workspace\"\r\n",
                    "size": 4,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Title"
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 12,
                        "formatOptions": {
                          "min": -1,
                          "palette": "blue"
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "Text",
                        "formatter": 1
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "70",
                  "name": "query-TotalAuxiliaryLogs"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourcegroups/{Workspace:resourcegroup}/providers/microsoft.operationalinsights/workspaces/{Workspace:name}/tables?api-version=2021-12-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.properties.plan==\\\"Auxiliary\\\")]\",\"columns\":[{\"path\":\"name\",\"columnid\":\"TableName\",\"columnType\":\"string\"},{\"path\":\"$..properties.schema.tableType\",\"columnid\":\"TableType\",\"columnType\":\"string\"},{\"path\":\"$..properties.totalRetentionInDays\",\"columnid\":\"TotalRetentionInDays\",\"columnType\":\"long\"},{\"path\":\"$..properties.retentionInDays\",\"columnid\":\"InteractiveRetentionInDays\",\"columnType\":\"long\"},{\"path\":\"$..properties.archiveRetentionInDays\",\"columnid\":\"ArchiveRetentionInDays\",\"columnType\":\"long\"}]}}]}",
                    "size": 1,
                    "title": "Auxiliary Logs Table",
                    "noDataMessage": "Currently no Auxiliary Logs being configured",
                    "queryType": 12,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TableName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "TableType",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Microsoft",
                                "representation": "brown",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "CustomLog",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "14ch"
                          }
                        },
                        {
                          "columnMatch": "TotalRetentionInDays",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "palette": "turquoise",
                            "customColumnWidthSetting": "24ch"
                          }
                        },
                        {
                          "columnMatch": "InteractiveRetentionInDays",
                          "formatter": 8,
                          "formatOptions": {
                            "min": -180,
                            "max": 730,
                            "palette": "purpleBlue",
                            "customColumnWidthSetting": "28ch"
                          }
                        },
                        {
                          "columnMatch": "ArchiveRetentionInDays",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 700,
                            "palette": "purpleDark",
                            "customColumnWidthSetting": "26ch"
                          }
                        }
                      ]
                    }
                  },
                  "name": "query-AuxiliaryLogsTable"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| where StartTime {TimeRange:value}\r\n| where IsBillable == 'true'\r\n| summarize ['Table Size'] =sum(Quantity) by DataType\r\n| order by ['Table Size']  desc\r\n| join kind= leftouter (\r\nUsage\r\n| where StartTime {TimeRange:value}\r\n| where IsBillable == 'true'\r\n| make-series IngestionTrend = sum(Quantity) default =0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DataType\r\n) on DataType\r\n| project-away DataType1, TimeGenerated",
                    "size": 1,
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "sortBy": [
                        {
                          "itemKey": "DataType",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "DataType",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "test",
                    "comparison": "isEqualTo",
                    "value": "1"
                  },
                  "name": "query-AuxiliaryLogsSizeTemp"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Select the Auxiliary Log tables to calculate the cost",
                    "style": "info"
                  },
                  "name": "text - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"6c3843df-dec0-449b-b7d4-c096487af14b\",\"mergeType\":\"leftouter\",\"leftTable\":\"query-AuxiliaryLogsTable\",\"rightTable\":\"query-AuxiliaryLogsSizeTemp\",\"leftColumn\":\"TableName\",\"rightColumn\":\"DataType\"}],\"projectRename\":[{\"originalName\":\"[query-AuxiliaryLogsTable].TableName\",\"mergedName\":\"TableName\",\"fromId\":\"6c3843df-dec0-449b-b7d4-c096487af14b\"},{\"originalName\":\"[query-AuxiliaryLogsTable].TableType\",\"mergedName\":\"TableType\",\"fromId\":\"6c3843df-dec0-449b-b7d4-c096487af14b\"},{\"originalName\":\"[query-AuxiliaryLogsTable].TotalRetentionInDays\",\"mergedName\":\"TotalRetentionInDays\",\"fromId\":\"6c3843df-dec0-449b-b7d4-c096487af14b\"},{\"originalName\":\"[query-AuxiliaryLogsTable].InteractiveRetentionInDays\",\"mergedName\":\"InteractiveRetentionInDays\",\"fromId\":\"6c3843df-dec0-449b-b7d4-c096487af14b\"},{\"originalName\":\"[query-AuxiliaryLogsTable].ArchiveRetentionInDays\",\"mergedName\":\"ArchiveRetentionInDays\",\"fromId\":\"6c3843df-dec0-449b-b7d4-c096487af14b\"},{\"originalName\":\"[query-AuxiliaryLogsSizeTemp].DataType\",\"mergedName\":\"DataType\",\"fromId\":\"6c3843df-dec0-449b-b7d4-c096487af14b\"},{\"originalName\":\"[query-AuxiliaryLogsSizeTemp].Table Size\",\"mergedName\":\"Table Size\",\"fromId\":\"6c3843df-dec0-449b-b7d4-c096487af14b\"},{\"originalName\":\"[query-AuxiliaryLogsSizeTemp].IngestionTrend\",\"mergedName\":\"IngestionTrend\",\"fromId\":\"6c3843df-dec0-449b-b7d4-c096487af14b\"},{\"originalName\":\"[query-BasicLogsTable].TableType\"},{\"originalName\":\"[query-BasicLogsTable].TotalRetentionInDays\"},{\"originalName\":\"[query-BasicLogsTable].InteractiveRetentionInDays\"},{\"originalName\":\"[query-BasicLogsTable].ArchiveRetentionInDays\"},{\"originalName\":\"[query-BasicLogsSizeTemp].DataType\"}]}",
                    "size": 1,
                    "title": "Basic Logs Table Size, from: {TimeRange:label} data",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "TableName",
                        "parameterName": "auxiliaryTableName",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 7,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table Size",
                          "formatter": 3,
                          "formatOptions": {
                            "min": 0,
                            "palette": "greenRed",
                            "customColumnWidthSetting": "240px"
                          },
                          "numberFormat": {
                            "unit": 38,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "IngestionTrend",
                          "formatter": 9,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue"
                          }
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "AuxiliaryTables",
                    "comparison": "isNotEqualTo"
                  },
                  "showPin": false,
                  "name": "query-AuxiliaryLogsMerge"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| where IsBillable == true\r\n| where DataType has_any ('{auxiliaryTableName}')\r\n| summarize size = sum(Quantity)/1024 by DataType\r\n| project ['Log Type'] = \"Custom Log\",['Table'] = DataType, ['Table Size'] = size, ['Estimated cost'] = size*{auxiliaryCost};",
                    "size": 0,
                    "title": "Auxiliary Logs Cost",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "conditionalVisibility": {
                    "parameterName": "auxiliaryTableName",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "query - 5"
                }
              ]
            },
            "customWidth": "70",
            "name": "Auxiliary-groupTables"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### Auxiliary Logs ###\r\n\r\nIn this section, you will be presented with a list of Auxiliary Logs tables configured in your workspace (if any).\r\n\r\nThere might be logs in your environment that generate a large volume of verbose data but contain relatively limited security detection value. These logs can be needed for threat hunting, auditing, or compliance purposes but are often not critical for deep analytics and alerts.\r\n\r\n**Auxiliary Logs** is a cost-effective data plan that provides a lower-cost option for ingestion of high-volume verbose logs without the full capabilities of analytics logs.\r\nAuxiliary Logs will be accessible for interactive queries for the first 8 days. \r\nAfterwards, [archived logs](https://learn.microsoft.com/azure/azure-monitor/logs/data-retention-archive?tabs=portal-1%2Cportal-2) can be enabled to store the data. Before configuring tables as Auxiliary Logs, [compare log data plans](https://learn.microsoft.com/azure/azure-monitor/logs/basic-logs-configure?tabs=portal-1#compare-the-basic-and-analytics-log-data-plans) to find out more about the offering and differences between Auxiliary Logs and default Analytics Logs.\r\n\r\n<br>\r\n**When should I use Auxiliary logs?**\r\n\r\nBy default, all tables in your Log Analytics workspace are Analytics tables, and they're available for query and alerts.\r\n\r\nConfigure a table for Auxiliary logs if:\r\n\r\n- You don't require more than eight days of data retention for the table.\r\n\r\n- You only require basic queries of the data using a [limited version of the query language](https://learn.microsoft.com/azure/azure-monitor/logs/basic-logs-query?tabs=portal-1#limitations).\r\n\r\n- The cost savings for data ingestion exceed the expected cost for any expected queries.\r\n\r\n<br>\r\n**For more information**, refer to the following links:\r\n\r\n- [Auxiliary Logs use cases](https://learn.microsoft.com/azure/sentinel/basic-logs-use-cases)\r\n\r\n- [The table that supports Auxiliary logs](https://learn.microsoft.com/azure/azure-monitor/logs/basic-logs-configure?tabs=portal-1#when-should-i-use-basic-logs)\r\n\r\n- [How to set a table's log data plan to Auxiliary or Analytics](https://learn.microsoft.com/azure/azure-monitor/logs/basic-logs-configure?tabs=portal-1#set-a-tables-log-data-plan)\r\n\r\n- [Microsoft Sentinel Pricing Page](https://azure.microsoft.com/pricing/details/microsoft-sentinel/)",
                    "style": "upsell"
                  },
                  "name": "text-BasicLogs"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "2b8f0ca5-1278-4ea2-a851-94c61372a1a4",
                        "cellValue": "",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Open Tables page",
                        "subTarget": "test",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "TablesBlade",
                          "extensionName": "Microsoft_OperationsManagementSuite_Workspace",
                          "bladeParameters": [
                            {
                              "name": "workspaceResourceId",
                              "source": "static",
                              "value": "{Workspace:id}"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "name": "links-OpenRestoration"
                }
              ]
            },
            "customWidth": "30",
            "conditionalVisibility": {
              "parameterName": "Help",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "groupInsights-AuxiliaryLogs"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Sentinel"
      },
      "name": "group-AuxLogs",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Microsoft Sentinel Benefits"
            },
            "name": "text - 2"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "d16f6fe2-9caa-4d98-8a6e-88764bedbb05",
                        "version": "KqlParameterItem/1.0",
                        "name": "TotalE5Seats",
                        "label": "Total seats (E5/A5/F5/G5)",
                        "type": 1,
                        "description": "Enter the total number of Microsoft 365 E5, A5, F5, G5 and Microsoft 365 E5, A5, F5, G5 Security licenses in your environment",
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "value": "25"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - 8"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| where IsBillable == true\r\n| where DataType in (\"SigninLogs\", \r\n\"AuditLogs\", \r\n\"AADNonInteractiveUserSignInLogs\", \r\n\"AADServicePrincipalSignInLogs\",\r\n\"AADManagedIdentitySignInLogs\",\r\n\"AADProvisioningLogs\",\r\n\"ADFSSignInLogs\",\r\n\"McasShadowItReporting\", \r\n\"InformationProtectionLogs_CL\", \r\n\"DeviceEvents\",‚ÄØ \r\n\"DeviceFileEvents\",‚ÄØ \r\n\"DeviceImageLoadEvents\",‚ÄØ \r\n\"DeviceInfo\",‚ÄØ \r\n\"DeviceLogonEvents\",‚ÄØ \r\n\"DeviceNetworkEvents\",‚ÄØ \r\n\"DeviceNetworkInfo\",‚ÄØ \r\n\"DeviceProcessEvents\",‚ÄØ \r\n\"DeviceRegistryEvents\",\r\n\"DeviceFileCertificateInfo\",‚ÄØ \r\n\"EmailAttachmentInfo\",‚ÄØ \r\n\"EmailEvents\",‚ÄØ \r\n\"EmailPostDeliveryEvents\",‚ÄØ \r\n\"EmailUrlInfo\",\r\n\"IdentityLogonEvents\",\r\n\"IdentityQueryEvents\",\r\n\"IdentityDirectoryEvents\",\r\n\"AlertEvidence\",\r\n\"CloudAppEvents\"\r\n) ‚ÄØ \r\n| summarize BillableDataGB = sum(Quantity) / 1000. by DataType\r\n| order by BillableDataGB desc\r\n",
                    "size": 0,
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "BillableDataGB",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - 13"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<br/>"
                  },
                  "name": "text - 10"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| where IsBillable == true\r\n| where DataType in (\"SigninLogs\", \r\n\"AuditLogs\", \r\n\"AADNonInteractiveUserSignInLogs\", \r\n\"AADServicePrincipalSignInLogs\",\r\n\"AADManagedIdentitySignInLogs\",\r\n\"AADProvisioningLogs\",\r\n\"ADFSSignInLogs\",\r\n\"McasShadowItReporting\", \r\n\"InformationProtectionLogs_CL\", \r\n\"DeviceEvents\",‚ÄØ \r\n\"DeviceFileEvents\",‚ÄØ \r\n\"DeviceImageLoadEvents\",‚ÄØ \r\n\"DeviceInfo\",‚ÄØ \r\n\"DeviceLogonEvents\",‚ÄØ \r\n\"DeviceNetworkEvents\",‚ÄØ \r\n\"DeviceNetworkInfo\",‚ÄØ \r\n\"DeviceProcessEvents\",‚ÄØ \r\n\"DeviceRegistryEvents\",\r\n\"DeviceFileCertificateInfo\",‚ÄØ \r\n\"EmailAttachmentInfo\",‚ÄØ \r\n\"EmailEvents\",‚ÄØ \r\n\"EmailPostDeliveryEvents\",‚ÄØ \r\n\"EmailUrlInfo\",\r\n\"IdentityLogonEvents\",\r\n\"IdentityQueryEvents\",\r\n\"IdentityDirectoryEvents\",\r\n\"AlertEvidence\",\r\n\"CloudAppEvents\") ‚ÄØ \r\n| summarize DailyIngestionGB = toreal(sum(Quantity))/ 1024  by format_datetime(TimeGenerated, 'yyyy-MM-dd') \r\n| extend MaxDataGrantGB  = ((5*toreal({TotalE5Seats}))/1024)\r\n| sort by TimeGenerated asc\r\n",
                    "size": 0,
                    "aggregation": 3,
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "linechart",
                    "chartSettings": {
                      "xAxis": "TimeGenerated",
                      "showDataPoints": true,
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 0,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumFractionDigits": 3
                          }
                        }
                      }
                    }
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "TotalE5Seats",
                      "comparison": "isNotEqualTo"
                    },
                    {
                      "parameterName": "TotalE5Seats",
                      "comparison": "isNotEqualTo",
                      "value": "0"
                    }
                  ],
                  "name": "DailyIngestionVSAllocation"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| where IsBillable == true\r\n| where DataType in (\"SigninLogs\", \r\n\"AuditLogs\", \r\n\"AADNonInteractiveUserSignInLogs\", \r\n\"AADServicePrincipalSignInLogs\",\r\n\"AADManagedIdentitySignInLogs\",\r\n\"AADProvisioningLogs\",\r\n\"ADFSSignInLogs\",\r\n\"McasShadowItReporting\", \r\n\"InformationProtectionLogs_CL\", \r\n\"DeviceEvents\",‚ÄØ \r\n\"DeviceFileEvents\",‚ÄØ \r\n\"DeviceImageLoadEvents\",‚ÄØ \r\n\"DeviceInfo\",‚ÄØ \r\n\"DeviceLogonEvents\",‚ÄØ \r\n\"DeviceNetworkEvents\",‚ÄØ \r\n\"DeviceNetworkInfo\",‚ÄØ \r\n\"DeviceProcessEvents\",‚ÄØ \r\n\"DeviceRegistryEvents\",\r\n\"DeviceFileCertificateInfo\",‚ÄØ \r\n\"EmailAttachmentInfo\",‚ÄØ \r\n\"EmailEvents\",‚ÄØ \r\n\"EmailPostDeliveryEvents\",‚ÄØ \r\n\"EmailUrlInfo\",\r\n\"IdentityLogonEvents\",\r\n\"IdentityQueryEvents\",\r\n\"IdentityDirectoryEvents\",\r\n\"AlertEvidence\",\r\n\"CloudAppEvents\"\r\n) ‚ÄØ \r\n| summarize TotalBillableDataGB = sum(Quantity) / 1024\r\n\r\n",
                    "size": 4,
                    "title": "Total ingestion",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "TotalBillableDataGB",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "greenRed"
                        },
                        "numberFormat": {
                          "unit": 39,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "20",
                  "name": "E5IngestionSize"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DailyMaxDiscountGB  = ((5*toreal({TotalE5Seats}))/1024);\r\nUsage\r\n| where IsBillable == true\r\n| where DataType in (\"SigninLogs\", \r\n\"AuditLogs\", \r\n\"AADNonInteractiveUserSignInLogs\", \r\n\"AADServicePrincipalSignInLogs\",\r\n\"AADManagedIdentitySignInLogs\",\r\n\"AADProvisioningLogs\",\r\n\"ADFSSignInLogs\",\r\n\"McasShadowItReporting\", \r\n\"InformationProtectionLogs_CL\", \r\n\"DeviceEvents\",‚ÄØ \r\n\"DeviceFileEvents\",‚ÄØ \r\n\"DeviceImageLoadEvents\",‚ÄØ \r\n\"DeviceInfo\",‚ÄØ \r\n\"DeviceLogonEvents\",‚ÄØ \r\n\"DeviceNetworkEvents\",‚ÄØ \r\n\"DeviceNetworkInfo\",‚ÄØ \r\n\"DeviceProcessEvents\",‚ÄØ \r\n\"DeviceRegistryEvents\",\r\n\"DeviceFileCertificateInfo\",‚ÄØ \r\n\"EmailAttachmentInfo\",‚ÄØ \r\n\"EmailEvents\",‚ÄØ \r\n\"EmailPostDeliveryEvents\",‚ÄØ \r\n\"EmailUrlInfo\",\r\n\"IdentityLogonEvents\",\r\n\"IdentityQueryEvents\",\r\n\"IdentityDirectoryEvents\",\r\n\"AlertEvidence\",\r\n\"CloudAppEvents\") ‚ÄØ \r\n| summarize DailyBillableGB = toreal(sum(Quantity))/ 1024  by format_datetime(TimeGenerated, 'yy-MM-dd') \r\n| extend DailyMaxGrantGB = DailyMaxDiscountGB\r\n| summarize MaxDataGrantGB = sum(toreal(DailyMaxGrantGB))\r\n\r\n",
                    "size": 4,
                    "title": "Total Data Grant Limit",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "MaxDataGrantGB",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "orangeBlue"
                        },
                        "numberFormat": {
                          "unit": 39,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "showBorder": false,
                      "sortOrderField": 1
                    }
                  },
                  "customWidth": "20",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "TotalE5Seats",
                      "comparison": "isNotEqualTo"
                    },
                    {
                      "parameterName": "TotalE5Seats",
                      "comparison": "isNotEqualTo",
                      "value": "0"
                    }
                  ],
                  "name": "DataGrantLimit"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DailyMaxDiscountGB  = ((5*toreal({TotalE5Seats}))/1024);\r\nUsage\r\n| where IsBillable == true\r\n| where DataType in (\"SigninLogs\", \r\n\"AuditLogs\", \r\n\"AADNonInteractiveUserSignInLogs\", \r\n\"AADServicePrincipalSignInLogs\",\r\n\"AADManagedIdentitySignInLogs\",\r\n\"AADProvisioningLogs\",\r\n\"ADFSSignInLogs\",\r\n\"McasShadowItReporting\", \r\n\"InformationProtectionLogs_CL\", \r\n\"DeviceEvents\",‚ÄØ \r\n\"DeviceFileEvents\",‚ÄØ \r\n\"DeviceImageLoadEvents\",‚ÄØ \r\n\"DeviceInfo\",‚ÄØ \r\n\"DeviceLogonEvents\",‚ÄØ \r\n\"DeviceNetworkEvents\",‚ÄØ \r\n\"DeviceNetworkInfo\",‚ÄØ \r\n\"DeviceProcessEvents\",‚ÄØ \r\n\"DeviceRegistryEvents\",\r\n\"DeviceFileCertificateInfo\",‚ÄØ \r\n\"EmailAttachmentInfo\",‚ÄØ \r\n\"EmailEvents\",‚ÄØ \r\n\"EmailPostDeliveryEvents\",‚ÄØ \r\n\"EmailUrlInfo\",\r\n\"IdentityLogonEvents\",\r\n\"IdentityQueryEvents\",\r\n\"IdentityDirectoryEvents\",\r\n\"AlertEvidence\",\r\n\"CloudAppEvents\") ‚ÄØ \r\n| summarize DailyBillableGB = toreal(sum(Quantity))/ 1024  by format_datetime(TimeGenerated, 'yy-MM-dd') \r\n| summarize TotalEligibleGB = sum(iif(toreal(DailyBillableGB)>toreal(DailyMaxDiscountGB),toreal(DailyMaxDiscountGB),DailyBillableGB))\r\n\r\n",
                    "size": 4,
                    "title": "Total Data Grant Used",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "TotalEligibleGB",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "coldHot"
                        },
                        "numberFormat": {
                          "unit": 39,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "showBorder": false,
                      "sortOrderField": 1
                    }
                  },
                  "customWidth": "30",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "TotalE5Seats",
                      "comparison": "isNotEqualTo"
                    },
                    {
                      "parameterName": "TotalE5Seats",
                      "comparison": "isNotEqualTo",
                      "value": "0"
                    }
                  ],
                  "name": "EligibleE5Ingestion"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DailyMaxDiscountGB  = ((5*toreal({TotalE5Seats}))/1024);\r\nUsage\r\n| where IsBillable == true\r\n| where DataType in (\"SigninLogs\", \r\n\"AuditLogs\", \r\n\"AADNonInteractiveUserSignInLogs\", \r\n\"AADServicePrincipalSignInLogs\",\r\n\"AADManagedIdentitySignInLogs\",\r\n\"AADProvisioningLogs\",\r\n\"ADFSSignInLogs\",\r\n\"McasShadowItReporting\", \r\n\"InformationProtectionLogs_CL\", \r\n\"DeviceEvents\",‚ÄØ \r\n\"DeviceFileEvents\",‚ÄØ \r\n\"DeviceImageLoadEvents\",‚ÄØ \r\n\"DeviceInfo\",‚ÄØ \r\n\"DeviceLogonEvents\",‚ÄØ \r\n\"DeviceNetworkEvents\",‚ÄØ \r\n\"DeviceNetworkInfo\",‚ÄØ \r\n\"DeviceProcessEvents\",‚ÄØ \r\n\"DeviceRegistryEvents\",\r\n\"DeviceFileCertificateInfo\",‚ÄØ \r\n\"EmailAttachmentInfo\",‚ÄØ \r\n\"EmailEvents\",‚ÄØ \r\n\"EmailPostDeliveryEvents\",‚ÄØ \r\n\"EmailUrlInfo\",\r\n\"IdentityLogonEvents\",\r\n\"IdentityQueryEvents\",\r\n\"IdentityDirectoryEvents\",\r\n\"AlertEvidence\",\r\n\"CloudAppEvents\") ‚ÄØ \r\n| summarize DailyBillableGB = toreal(sum(Quantity))/ 1024  by format_datetime(TimeGenerated, 'yy-MM-dd') \r\n| summarize TotalEligibleGB = sum(iif(toreal(DailyBillableGB)>toreal(DailyMaxDiscountGB),toreal(DailyMaxDiscountGB),DailyBillableGB))\r\n| extend TotalDiscount = toreal(TotalEligibleGB)*{paygCost}\r\n| project TotalDiscount\r\n\r\n",
                    "size": 4,
                    "title": "Estimated Saving",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "TotalDiscount",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "greenRed"
                        },
                        "numberFormat": {
                          "unit": 0,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "20",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "TotalE5Seats",
                      "comparison": "isNotEqualTo",
                      "value": "0"
                    },
                    {
                      "parameterName": "TotalE5Seats",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "EstimateE5Discount"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<br>\r\n**Daily ingestion size (for eligible data sources) vs Maximum data grant:**"
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "TotalE5Seats",
                      "comparison": "isNotEqualTo",
                      "value": "0"
                    },
                    {
                      "parameterName": "TotalE5Seats",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "text - DailyIngestionVsAllocation"
                }
              ]
            },
            "customWidth": "70",
            "name": "group - BenefitsData"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# Microsoft Sentinel Benefits for Microsoft 365 E5, A5, F5, and G5 Customers\r\n\r\n## Overview\r\n\r\nMicrosoft Sentinel integrates seamlessly with Microsoft 365 E5, A5, F5, and G5 licenses to provide robust security information and event management (SIEM) and extended detection and response (XDR) solutions. This setup empowers your organization to detect and mitigate sophisticated, cross-domain threats with greater accuracy and speed.\r\n\r\n### **Data Grant Overview**\r\n\r\nFor organizations with Microsoft 365 E5, A5, F5, G5, or corresponding Security licenses, Microsoft offers a valuable data grant. This grant allows up to 5 MB per user per day of Microsoft 365 data to be ingested into Microsoft Sentinel at no additional cost. This offer is particularly beneficial for organizations looking to optimize their security operations while managing costs effectively.\r\n\r\n### **Included Data Sources**\r\n\r\nThe data grant covers ingestion from the following data sources:\r\n- **Microsoft Entra ID (Azure AD) Sign-in and Audit Logs**: Monitor and audit all sign-ins and changes within your Azure Active Directory.\r\n- **Microsoft Cloud App Security Shadow IT Discovery Logs**: Gain insights into unapproved IT usage within your organization.\r\n- **Microsoft Information Protection Logs**: Track and manage the protection of sensitive information across your environment.\r\n- **Microsoft 365 Advanced Hunting Data**: Conduct deep-dive investigations into security threats with advanced hunting capabilities.\r\n\r\nThis data grant is automatically applied to your billing at the end of each month, ensuring up to 5 MB per user per day is covered without additional charges.\r\n\r\n### **Ingestion and Savings Calculation**\r\n\r\nTo make the most of this benefit and accurately assess your savings:\r\n1. **Specify Your Total Seats**: Input the total number of Microsoft 365 E5, A5, F5, or G5 seats in your environment. This number is crucial for determining the size of your data grant.\r\n2. **Define Your Ingestion Price**: Set the price per GB for data ingestion. This will help you calculate potential savings and understand the costs if your data ingestion exceeds the grant.\r\n\r\nBy carefully configuring these parameters, you can optimize your data ingestion strategy and fully utilize the data grant provided by Microsoft.\r\n\r\n### **Visualizing Your Data and Costs**\r\n\r\nThe workbook you are using offers several visualizations to help you monitor and manage your data ingestion and associated costs:\r\n\r\n1. **Total Billable Data**: Visualize the total amount of data ingested from eligible data sources, measured in gigabytes (GB). This metric helps you understand your current data ingestion levels.\r\n\r\n2. **Daily Ingestion vs. Data Grant**: A line chart compares your daily data ingestion against the maximum data grant allowed by your licenses. This visualization helps you track whether your daily usage stays within the limits covered by the grant.\r\n\r\n3. **Total Data Grant Limit**: This tile shows the cumulative maximum data grant based on your total number of seats. It provides a quick reference for the upper limit of the data that can be ingested without incurring additional costs.\r\n\r\n4. **Total Data Grant Used**: Track the amount of your data grant that has been utilized. This helps in ensuring that you are making full use of the available grant.\r\n\r\n5. **Estimated Savings**: Calculate the financial savings achieved by staying within the data grant limits. This tile provides a clear view of how much you are saving based on your current ingestion patterns and the grant.\r\n\r\n### **Identifying Your Licenses**\r\n\r\nTo leverage these benefits, you need to identify the number and type of licenses your organization currently holds. This can typically be done through your Microsoft 365 admin center:\r\n\r\n1. **Access the Microsoft 365 Admin Center**: Log in to the admin center with the appropriate administrative credentials.\r\n2. **Navigate to Licenses**: Go to the 'Billing' section and then 'Licenses' to see the number and type of licenses assigned to users within your organization.\r\n3. **Review Assigned Licenses**: Check the total count of E5, A5, F5, and G5 licenses. This information will help you set the correct parameters in the workbook.\r\n\r\nBy understanding your license allocation, you can ensure that the data grant is correctly calculated and applied, allowing you to maximize your use of Microsoft Sentinel while managing costs effectively.\r\n\r\n### **Additional Resources**\r\n\r\nFor more detailed information and to explore how your organization can benefit from Microsoft Sentinel's data grant, visit:\r\n- [Microsoft Sentinel and Microsoft 365 Offer Page](https://azure.microsoft.com/offers/sentinel-microsoft-365-offer/)\r\n\r\nBy regularly reviewing and adjusting your workbook parameters based on your license status and data ingestion trends, you can optimize your security operations and take full advantage of the benefits offered by Microsoft Sentinel.",
                    "style": "upsell"
                  },
                  "conditionalVisibility": {
                    "parameterName": "Help",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text-benefitsHelp"
                }
              ]
            },
            "customWidth": "30",
            "conditionalVisibility": {
              "parameterName": "Help",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "group - BenefitsHelp"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Benefits"
      },
      "name": "group - Sentinel Benefits",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Security orchestration, automation, and response (SOAR) Costs\r\n"
            },
            "name": "text - 2"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "6f50ee54-8f0e-424e-9e16-70eca531af7f",
                        "version": "KqlParameterItem/1.0",
                        "name": "ResourceTypes",
                        "label": "Resource types",
                        "type": 7,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "value": [
                          "microsoft.logic/workflows"
                        ],
                        "isHiddenWhenLocked": true,
                        "typeSettings": {
                          "includeAll": true
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "1c8dc8da-2233-426c-8cfc-52ec31bf1e84",
                        "version": "KqlParameterItem/1.0",
                        "name": "Subscription",
                        "label": "üîë Subscriptions",
                        "type": 6,
                        "description": "The Azure Subscription where Microsoft Sentinel Playbooks are located",
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "Resources\r\n| where type in~ ({ResourceTypes})\r\n| summarize Count = count() by subscriptionId\r\n| order by Count desc\r\n| extend Rank = row_number()\r\n| project value = subscriptionId, label = subscriptionId, selected = Rank == 1",
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "defaultValue": "value::all",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "f103ef04-042e-45ed-8f78-b31e676258d7",
                        "version": "KqlParameterItem/1.0",
                        "name": "ResourceGroups",
                        "label": "üß∞ Resource groups",
                        "type": 2,
                        "description": "The Resource Group where the Microsoft Sentinel Playbooks are located",
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "Resources\r\n| where type in~ ({ResourceTypes})\r\n| summarize Count = count() by subscriptionId, resourceGroup\r\n| order by Count desc\r\n| extend Rank = row_number()\r\n| project value = strcat('/subscriptions/', subscriptionId, '/resourceGroups/', resourceGroup), label = resourceGroup, selected = false",
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "defaultValue": "value::all",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "b6514d02-8893-44b8-896e-e53ada5024d5",
                        "version": "KqlParameterItem/1.0",
                        "name": "Resources",
                        "label": "ü¶ø Logic Apps",
                        "type": 5,
                        "description": "The selection of Playbooks you want to query",
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "Resources\r\n| where type in~({ResourceTypes})\r\n| extend resourceGroupId = strcat('/subscriptions/', subscriptionId, '/resourceGroups/', resourceGroup)\r\n| where resourceGroupId in~({ResourceGroups}) or '*' in~({ResourceGroups})\r\n| order by name asc\r\n| extend Rank = row_number()\r\n| project value = id, label = tostring(name), selected = Rank <= 10, group = resourceGroup",
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "value": [
                          "value::all"
                        ]
                      },
                      {
                        "id": "8f552e99-2d30-4679-b4b0-25429bf0216b",
                        "version": "KqlParameterItem/1.0",
                        "name": "ExecutionCost",
                        "label": "üíµ Execution Cost",
                        "type": 1,
                        "description": "The cost to execute the playbooks (see help), needs to be manually populated",
                        "isRequired": true,
                        "value": "0.000020"
                      }
                    ],
                    "style": "above",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - 10"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbooke70b7cbc-f1d7-4a74-b8b9-75cc8d5ab586",
                    "version": "MetricsItem/2.0",
                    "size": 1,
                    "chartType": 0,
                    "resourceType": "microsoft.logic/workflows",
                    "metricScope": 0,
                    "resourceParameter": "Resources",
                    "resourceIds": [
                      "{Resources}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 7776000000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.logic/workflows",
                        "metric": "microsoft.logic/workflows--TotalBillableExecutions",
                        "aggregation": 1
                      }
                    ],
                    "title": "Click on a subscription below to calculate the estimated automation costs",
                    "resourceLimit": 10000,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "$gen_group",
                          "formatter": 15,
                          "formatOptions": {
                            "showIcon": true,
                            "linkTarget": "Resource"
                          }
                        },
                        {
                          "columnMatch": "Subscription",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Name",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "microsoft.logic/workflows--TotalBillableExecutions",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue",
                            "aggregation": "Sum"
                          }
                        },
                        {
                          "columnMatch": "microsoft.logic/workflows--TotalBillableExecutions Timeline",
                          "formatter": 21,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "microsoft.logic/workflows--BillableTriggerExecutions Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.logic/workflows--BillableActionExecutions",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "microsoft.logic/workflows--BillableActionExecutions Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "RG",
                          "formatter": 13,
                          "formatOptions": {
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "Sum",
                          "formatter": 1,
                          "formatOptions": {
                            "aggregation": "Sum"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "Subscription"
                        ]
                      },
                      "labelSettings": [
                        {
                          "columnId": "microsoft.logic/workflows--TotalBillableExecutions",
                          "label": "Total Billable Executions (Sum)"
                        },
                        {
                          "columnId": "microsoft.logic/workflows--TotalBillableExecutions Timeline",
                          "label": "Total Billable Executions Timeline"
                        }
                      ]
                    },
                    "exportFieldName": "microsoft.logic/workflows--TotalBillableExecutions",
                    "exportParameterName": "Total",
                    "exportDefaultValue": "0"
                  },
                  "name": "Billable Metric"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage | take 1 | project ['Estimated automation costs'] ={Total}*{ExecutionCost}",
                    "size": 4,
                    "title": "Estimated Logic App execution cost over the last {TimeRange}",
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Estimated automation costs",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "greenRed"
                        },
                        "numberFormat": {
                          "unit": 0,
                          "options": {
                            "style": "decimal",
                            "minimumFractionDigits": 2,
                            "maximumFractionDigits": 3
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Total",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "query - 11"
                }
              ]
            },
            "customWidth": "70",
            "name": "group - SOARData"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# SOAR Summary for Logic App Billing and Automation Costs\r\n\r\n## Overview\r\n\r\nThis section provides a detailed overview of the billing and costs associated with your Logic Apps, which play a crucial role in your Security Orchestration, Automation, and Response (SOAR) capabilities. The data displayed here is derived from the built-in metrics of Logic Apps, giving you a transparent view of the financial impact of your automation workflows.\r\n\r\n## Visualizations and Interactions\r\n\r\n### **1. Click on a Subscription to Calculate Estimated Automation Costs**\r\n   - **What You Are Seeing**: This section lists all the subscriptions associated with your Logic Apps. By clicking on the \">\" icon in the subscription column, you can drill down into the specific Logic Apps linked to that subscription.\r\n   - **Why It Matters**: Understanding which subscriptions are consuming the most resources allows you to identify areas where you can optimize your Logic App usage and control costs. This interactive feature helps you explore costs in greater detail and make informed decisions about managing your automation expenses.\r\n\r\n### **2. Estimated Logic App Execution Cost Over the Last {TimeRange}**\r\n   - **What You Are Seeing**: This visualization presents an estimate of the total costs associated with Logic App executions over the specified time range.\r\n   - **Why It Matters**: This tile provides a quick, at-a-glance estimate of how much your Logic App executions are costing you, helping you manage your budget and plan for future expenses. The estimate is calculated based on the total number of billable executions and your specified cost per execution.\r\n\r\n## How to Use This Section\r\n\r\n### **Exploring Billing Information**\r\n- **Drill Down by Subscription**: Click on any subscription listed in the table to see detailed information about the Logic Apps associated with it. This feature is particularly useful for understanding which parts of your automation strategy are driving costs and where you might need to optimize.\r\n\r\n### **Customizing Cost Calculations**\r\n- **Adjust Execution Costs**: If your Logic App execution costs differ from the default values, you can adjust them using the provided parameters. This customization ensures that the cost estimates you see are accurate and reflective of your actual spending.\r\n\r\n### **Using the Metrics**\r\n- **Total Billable Executions**: The table and charts provide a summary of the total number of billable executions across your Logic Apps. This metric is crucial for understanding how often your Logic Apps are being triggered and how that usage translates into costs.\r\n- **Estimated Automation Costs**: This tile shows the estimated cost based on the number of executions and the specified cost per execution. This quick summary helps you keep track of automation expenses and adjust your strategy if necessary.\r\n\r\n## Additional Resources\r\n\r\n- **[Azure Logic Apps Pricing Page](https://azure.microsoft.com/en-us/pricing/details/logic-apps/)**: For comprehensive details on pricing options and cost management strategies.\r\n- **[Best Practices for Logic Apps](https://learn.microsoft.com/en-us/azure/logic-apps/logic-apps-best-practices-and-troubleshooting)**: Learn how to optimize your Logic Apps for both cost and performance.\r\n- **[Microsoft Sentinel Logic Apps Integration Guide](https://learn.microsoft.com/en-us/azure/sentinel/connect-logic-apps)**: Step-by-step guidance on integrating Logic Apps with Microsoft Sentinel.\r\n- **[Microsoft Sentinel SOAR Overview](https://learn.microsoft.com/en-us/azure/sentinel/soar-overview)**: Understand how Logic Apps fit into a broader SOAR strategy and enhance your organization's security posture.\r\n\r\nBy regularly reviewing and interacting with the data in this section, you can gain a deeper understanding of your Logic Apps' costs and make strategic decisions to optimize your SOAR operations.",
                    "style": "upsell"
                  },
                  "conditionalVisibility": {
                    "parameterName": "Help",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text-BasicLogs"
                }
              ]
            },
            "customWidth": "30",
            "name": "group - SOARHelp"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "SOAR"
      },
      "name": "group - SOAR ",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Commitment Tiers"
            },
            "name": "text - 6"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "fec78265-6198-47fa-944d-8e1fc42b21d1",
                  "version": "KqlParameterItem/1.0",
                  "name": "skuName",
                  "label": "ü™¥ SKU Name",
                  "type": 2,
                  "description": "The Microsoft Sentinel ingestion SKU",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n  { \"value\": \"Pay-as-you-go\", \"label\": \"Pay-as-you-go\" },\r\n  { \"value\": \"100-gb-commitment-tier\", \"label\": \"100 GB Commitment Tier\", \"selected\": true },\r\n  { \"value\": \"200-gb-commitment-tier\", \"label\": \"200 GB Commitment Tier\" },\r\n  { \"value\": \"300-gb-commitment-tier\", \"label\": \"300 GB Commitment Tier\" },\r\n  { \"value\": \"400-gb-commitment-tier\", \"label\": \"400 GB Commitment Tier\" },\r\n  { \"value\": \"500-gb-commitment-tier\", \"label\": \"500 GB Commitment Tier\" },\r\n  { \"value\": \"1000-gb-commitment-tier\", \"label\": \"1000 GB Commitment Tier\"},\r\n  { \"value\": \"2000-gb-commitment-tier\", \"label\": \"2000 GB Commitment Tier\" },\r\n  { \"value\": \"5000-gb-commitment-tier\", \"label\": \"5000 GB Commitment Tier\" },\r\n  { \"value\": \"10000-gb-commitment-tier\", \"label\": \"10000 GB Commitment Tier\" },\r\n  { \"value\": \"25000-gb-commitment-tier\", \"label\": \"25000 GB Commitment Tier\" },\r\n  { \"value\": \"50000-gb-commitment-tier\", \"label\": \"50000 GB Commitment Tier\" }\r\n]",
                  "value": "Pay-as-you-go"
                },
                {
                  "id": "206f147b-51b4-4773-a7e4-3473e7530231",
                  "version": "KqlParameterItem/1.0",
                  "name": "currencyCode",
                  "label": "üí± Currency",
                  "type": 2,
                  "description": "The currency you wish to view the workbook in",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n  { \"value\": \"GBP\", \"label\": \"Pound Stirling (¬£)\", \"selected\": true },\r\n  { \"value\": \"EUR\", \"label\": \"Euros (‚Ç¨)\" },\r\n  { \"value\": \"USD\", \"label\": \"United States Dollar ($)\" }\r\n]"
                },
                {
                  "id": "aab59f52-f31d-4c55-8020-aeb8e8980c3b",
                  "version": "KqlParameterItem/1.0",
                  "name": "location",
                  "label": "üåê Azure Region",
                  "type": 2,
                  "description": "The Azure region where your data is located",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n  { \"value\": \"AE Central\", \"label\": \"AE Central\" },\r\n  { \"value\": \"AE North\", \"label\": \"AE North\" },\r\n  { \"value\": \"AP East\", \"label\": \"AP East\" },\r\n  { \"value\": \"AP Southeast\", \"label\": \"AP Southeast\" },\r\n  { \"value\": \"AU Central\", \"label\": \"AU Central\" },\r\n  { \"value\": \"AU Central 2\", \"label\": \"AU Central 2\" },\r\n  { \"value\": \"AU East\", \"label\": \"AU East\" },\r\n  { \"value\": \"AU Southeast\", \"label\": \"AU Southeast\" },\r\n  { \"value\": \"BR South\", \"label\": \"BR South\" },\r\n  { \"value\": \"BR Southeast\", \"label\": \"BR Southeast\" },\r\n  { \"value\": \"CA Central\", \"label\": \"CA Central\" },\r\n  { \"value\": \"CA East\", \"label\": \"CA East\" },\r\n  { \"value\": \"CH North\", \"label\": \"CH North\" },\r\n  { \"value\": \"CH West\", \"label\": \"CH West\" },\r\n  { \"value\": \"DE North\", \"label\": \"DE North\" },\r\n  { \"value\": \"DE West Central\", \"label\": \"DE West Central\" },\r\n  { \"value\": \"ES Central\", \"label\": \"ES Central\" },\r\n  { \"value\": \"EU North\", \"label\": \"EU North\" },\r\n  { \"value\": \"EU West\", \"label\": \"EU West\" },\r\n  { \"value\": \"FR Central\", \"label\": \"FR Central\" },\r\n  { \"value\": \"FR South\", \"label\": \"FR South\" },\r\n  { \"value\": \"Global\", \"label\": \"Global\" },\r\n  { \"value\": \"IL Central\", \"label\": \"IL Central\" },\r\n  { \"value\": \"IN Central\", \"label\": \"IN Central\" },\r\n  { \"value\": \"IN Central Jio\", \"label\": \"IN Central Jio\" },\r\n  { \"value\": \"IN South\", \"label\": \"IN South\" },\r\n  { \"value\": \"IN West\", \"label\": \"IN West\" },\r\n  { \"value\": \"IN West Jio\", \"label\": \"IN West Jio\" },\r\n  { \"value\": \"IT North\", \"label\": \"IT North\" },\r\n  { \"value\": \"JA East\", \"label\": \"JA East\" },\r\n  { \"value\": \"JA West\", \"label\": \"JA West\" },\r\n  { \"value\": \"KR Central\", \"label\": \"KR Central\" },\r\n  { \"value\": \"KR South\", \"label\": \"KR South\" },\r\n  { \"value\": \"MX Central\", \"label\": \"MX Central\" },\r\n  { \"value\": \"NO East\", \"label\": \"NO East\" },\r\n  { \"value\": \"NO West\", \"label\": \"NO West\" },\r\n  { \"value\": \"PL Central\", \"label\": \"PL Central\" },\r\n  { \"value\": \"QA Central\", \"label\": \"QA Central\" },\r\n  { \"value\": \"SE Central\", \"label\": \"SE Central\" },\r\n  { \"value\": \"SE South\", \"label\": \"SE South\" },\r\n  { \"value\": \"UK South\", \"label\": \"UK South\", \"selected\": true },\r\n  { \"value\": \"UK West\", \"label\": \"UK West\" },\r\n  { \"value\": \"US Central\", \"label\": \"US Central\" },\r\n  { \"value\": \"US East\", \"label\": \"US East\" },\r\n  { \"value\": \"US East 2\", \"label\": \"US East 2\" },\r\n  { \"value\": \"US Gov AZ\", \"label\": \"US Gov AZ\" },\r\n  { \"value\": \"US Gov Virginia\", \"label\": \"US Gov Virginia\" },\r\n  { \"value\": \"US North Central\", \"label\": \"US North Central\" },\r\n  { \"value\": \"US South Central\", \"label\": \"US South Central\" },\r\n  { \"value\": \"US West\", \"label\": \"US West\" },\r\n  { \"value\": \"US West 2\", \"label\": \"US West 2\" },\r\n  { \"value\": \"US West 3\", \"label\": \"US West 3\" },\r\n  { \"value\": \"US West Central\", \"label\": \"US West Central\" },\r\n  { \"value\": \"ZA North\", \"label\": \"ZA North\" },\r\n  { \"value\": \"ZA West\", \"label\": \"ZA West\" }\r\n]"
                },
                {
                  "id": "0c448c7b-5dee-400c-baa5-a51e0de48794",
                  "version": "KqlParameterItem/1.0",
                  "name": "ingestionCost",
                  "label": "üíµ Ingestion Cost",
                  "type": 1,
                  "description": "Automantically calculated from the Azure region and Currency selection",
                  "query": "let jsonData = externaldata(\n    skuName:string,\n    unitOfMeasure:string,\n    type:string,\n    retailPrice:real,\n    unitPrice:real,\n    currencyCode:string,\n    location:string,\n    effectiveStartDate:datetime,\n    meterId:string,\n    meterName:string,\n    skuId:string,\n    productName:string,\n    serviceFamily:string\n)\n[\n    h@\"https://raw.githubusercontent.com/noodlemctwoodle/SentinelPublic/main/ExternalData/AllSentinelPrices.json\"\n]\nwith (format=\"multijson\");\njsonData\n| where skuName == \"{skuName:label}\"\n| where currencyCode == \"{currencyCode:value}\"\n| where location == \"{location:value}\"\n| project retailPrice",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "931976e2-dbb9-45b6-bb2b-81489309f157",
                  "version": "KqlParameterItem/1.0",
                  "name": "GBperday",
                  "label": "üìà GB Ingested Per Day",
                  "type": 1,
                  "description": "Calculated from selected SKU",
                  "query": "let jsonData = externaldata(\r\n    skuName:string,\r\n    unitOfMeasure:string,\r\n    type:string,\r\n    retailPrice:real,\r\n    unitPrice:real,\r\n    currencyCode:string,\r\n    location:string,\r\n    effectiveStartDate:datetime,\r\n    meterId:string,\r\n    meterName:string,\r\n    skuId:string,\r\n    productName:string,\r\n    serviceFamily:string\r\n)\r\n[\r\n    h@\"https://raw.githubusercontent.com/noodlemctwoodle/SentinelPublic/main/ExternalData/AllSentinelPrices.json\"\r\n]\r\nwith (format=\"multijson\");\r\njsonData\r\n| where skuName == \"{skuName:label}\"\r\n| extend GBperday = case(\r\n    skuName == \"Pay-as-you-go\", 1\r\n    , skuName == \"100 GB Commitment Tier\", 100\r\n    , skuName == \"200 GB Commitment Tier\", 200\r\n    , skuName == \"300 GB Commitment Tier\", 300\r\n    , skuName == \"400 GB Commitment Tier\", 400\r\n    , skuName == \"500 GB Commitment Tier\", 500\r\n    , skuName == \"1000 GB Commitment Tier\", 1000\r\n    , skuName == \"2000 GB Commitment Tier\", 2000\r\n    , skuName == \"5000 GB Commitment Tier\", 5000\r\n    , skuName == \"10000 GB Commitment Tier\", 10000\r\n    , skuName == \"25000 GB Commitment Tier\", 25000\r\n    , skuName == \"50000 GB Commitment Tier\", 50000\r\n    , 0\r\n)\r\n| project GBperday\r\n| take 1",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "eee06e9a-7ec9-41ba-8cff-c47d1a59b035",
                  "version": "KqlParameterItem/1.0",
                  "name": "sentinelCap",
                  "label": "SentinelCap",
                  "type": 1,
                  "description": "Automatically calculated from workspace",
                  "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where id has \"{Workspace}\"\r\n| extend sku = tolower(properties.sku.name)\r\n| extend capacityReservationLevel = properties.sku.capacityReservationLevel\r\n// add fake level for testing\r\n//| extend capacityReservationLevel = 200 , sku = \"capacityreservation\"\r\n//\r\n| project capacityReservationLevel",
                  "crossComponentResources": [
                    "{Subscription}"
                  ],
                  "isHiddenWhenLocked": true,
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                {
                  "id": "9c3b3654-0efb-4b93-928f-d801994db8b7",
                  "version": "KqlParameterItem/1.0",
                  "name": "discountRate",
                  "label": "DiscountRate",
                  "type": 1,
                  "description": "Automatically calculated from workspace",
                  "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where id has \"{Workspace}\"\r\n| extend sku = tolower(properties.sku.name)\r\n| extend capacityReservationLevel = properties.sku.capacityReservationLevel\r\n// add fake level for testing\r\n//| extend capacityReservationLevel = 2000 , sku = \"capacityreservation\"\r\n| extend discountRate = case(\r\ncapacityReservationLevel == 100,50,\r\ncapacityReservationLevel == 200,55,\r\ncapacityReservationLevel == 300,57,\r\ncapacityReservationLevel == 400,58,\r\ncapacityReservationLevel == 500,60,\r\ncapacityReservationLevel == 1000,61,\r\ncapacityReservationLevel == 2000,63,\r\ncapacityReservationLevel >= 5000,65,\r\n// else\r\n0\r\n)\r\n| project discountRate\r\n\r\n",
                  "isHiddenWhenLocked": true,
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                {
                  "id": "58447619-1e94-4a97-8470-24e1985e9d87",
                  "version": "KqlParameterItem/1.0",
                  "name": "lawCap",
                  "label": "Log Analytic Cap",
                  "type": 1,
                  "description": "Automatically calculated from workspace",
                  "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where id has \"{Workspace}\"\r\n| project capacityReservationLevel = properties.sku.capacityReservationLevel",
                  "crossComponentResources": [
                    "{Subscription}"
                  ],
                  "isHiddenWhenLocked": true,
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 1"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### Commitment Tier Section Overview\r\n\r\nThis section displays a table summarizing key details about your Azure Sentinel workspace, focusing on your current pricing tier and data retention settings.\r\n\r\n**Table Columns:**\r\n\r\n- **Workspace Name:** The name of the Log Analytics workspace being analyzed.\r\n- **Location:** The geographical region where the workspace is hosted.\r\n- **SKU:** The pricing model in use, such as 'Pay-as-you-go' (e.g., `pergb2018`).\r\n- **Commitment Tier:** If applicable, the level of daily data commitment in GB/day. In the displayed example, this is not applicable as the SKU is Pay-as-you-go.\r\n- **Discount Rate:** The percentage discount associated with the current commitment tier. This value is `0` for Pay-as-you-go plans, as discounts typically apply to commitment tiers.\r\n- **Tags:** Metadata tags associated with the workspace, such as environment or department.\r\n- **Data Retention:** The configured number of days data is retained in the workspace, with `90` days shown in the example.\r\n- **Data Retention Minus Free:** The difference between the retention period and the first 90 days, which are typically included at no extra charge.\r\n- **Retention Estimated Price:** The estimated cost of retaining data beyond the free retention period. This is `0` in the example, indicating no additional costs for retention beyond the initial 90 days.\r\n\r\nThis table helps you quickly assess your current pricing model, commitment tier status, and any potential additional costs related to data retention in Azure Sentinel.",
                    "style": "upsell"
                  },
                  "conditionalVisibility": {
                    "parameterName": "Help",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 4"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where id has \"{Workspace}\"\r\n| extend sku = tolower(properties.sku.name)\r\n| extend capacityReservationLevel = properties.sku.capacityReservationLevel\r\n| extend pricingTier = case(\r\nsku == 'capacityreservation' and capacityReservationLevel == 100, '100 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel == 200, '200 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel == 300, '300 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel == 400, '400 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel == 500, '500 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel == 1000, '1000 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel == 2000, '2000 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel >= 5000, '5000 GB/day and above Commitment Tier',\r\nsku == 'free', 'Free',\r\nsku == 'standard', 'Standard',\r\nsku == 'premium', 'Premium',\r\nsku == 'standalone', 'Standalone',\r\nsku == 'pernode', 'Per Node', \r\nsku == 'lacluster', 'Cluster Level Capacity Reservation',\r\nsku == 'pergb2018' or sku == 'pergb', 'Pay-as-you-go',\r\nstrcat('Unknown:',sku))\r\n| extend discountRate = case(\r\n    capacityReservationLevel == 100,50,\r\n    capacityReservationLevel == 200,55,\r\n    capacityReservationLevel == 300,57,\r\n    capacityReservationLevel == 400,58,\r\n    capacityReservationLevel == 500,60,\r\n    capacityReservationLevel == 1000,61,\r\n    capacityReservationLevel == 2000,63,\r\n    capacityReservationLevel >= 5000,65,\r\n    // else\r\n    0\r\n)\r\n| extend retentionInSentinel = iif({Retention} > 90,({Retention} -90) * {GBperday} * {Retention} ,tolong(0))\r\n| project ['Workspace Name']=id,  Location = location, SKU = sku, [\"Commitment Tier\"] = capacityReservationLevel, [\"Discount Rate\"] = discountRate ,  TAGs = tags, [\"Data Retention\"] = {Retention}, [\"Data Retention Minus Free\"] = {Retention}-90, [\"Retention Estimated Price\"] = retentionInSentinel\r\n\r\n\r\n",
                    "size": 4,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RetentionEstimatedPrice",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "Workspace",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "query - 16"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### Commitment Tier Insight\r\n\r\nThis section provides a detailed overview of your Azure Sentinel data usage and cost estimates based on your selected Commitment Tier. The report shows the Average GB/day usage over a specified time range, rounded to the nearest whole number. This figure is essential for calculating costs using the [Azure Pricing Calculator](https://azure.microsoft.com/pricing/calculator/) for Sentinel.\r\n\r\n**Key Metrics:**\r\n\r\n- **Pay as You Go (PAYG_estimate):** This represents the estimated daily cost based on your average GB/day usage multiplied by the [Sentinel Price] parameter (default is $2.00 for EAST US). This estimate is location and currency neutral, so you should adjust it according to your preferred region and currency.\r\n\r\n- **Pay as You Go (PAYG_estimate_mthly):** This provides an estimate of your monthly costs, calculated over 31 days.\r\n\r\n- **Commitment Tier Estimate Monthly:** This figure represents your monthly cost estimate after applying any discounts associated with the currently selected Commitment Tier.\r\n\r\n- **Exceeding Commitment Tier:** Data ingested into Sentinel that exceeds your selected daily commitment tier will be charged at the effective tier prices. For more details, refer to the [Azure Sentinel Pricing Page](https://azure.microsoft.com/pricing/details/azure-sentinel/).\r\n\r\nThis summary helps you monitor and optimize your Sentinel costs by understanding your data usage patterns and how they impact your billing, allowing you to make informed decisions about your Commitment Tier selection.",
                    "style": "upsell"
                  },
                  "conditionalVisibility": {
                    "parameterName": "Help",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 4"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| where IsBillable == True\r\n| summarize dataPerDay = sum(Quantity)/1000  by bin(TimeGenerated,1d), SentinelCT='{sentinelCap}'\r\n| extend higherCT = case(\r\n                   dataPerDay < 100, 100,\r\n                   dataPerDay > 100  and dataPerDay < 200, 200,\r\n                   dataPerDay > 200  and dataPerDay < 300, 300,\r\n                   dataPerDay > 300  and dataPerDay < 400, 400,\r\n                   dataPerDay > 400  and dataPerDay < 500, 500,\r\n                   dataPerDay > 500  and dataPerDay < 1000, 1000,\r\n                   dataPerDay > 1000 and dataPerDay < 10000, 10000,\r\n                   dataPerDay > 2000 and dataPerDay < 20000, 20000,\r\n                   dataPerDay > 5000 and dataPerDay < 50000, 50000,\r\n                   // else\r\n                   0\r\n                   )\r\n//| extend lowerCT= (higherCT - 100)\r\n\r\n\r\n\r\n",
                    "size": 1,
                    "aggregation": 3,
                    "showAnnotations": true,
                    "title": "Actual Data Volume and Commitment Tier.  Data from: {TimeRange:label}.  ",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "y",
                    "exportParameterName": "yAxis",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "timechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Column1",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "dataPerDay",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ]
                    },
                    "chartSettings": {
                      "yAxis": [
                        "higherCT",
                        "SentinelCT",
                        "dataPerDay"
                      ],
                      "seriesLabelSettings": [
                        {
                          "seriesName": "higherCT",
                          "label": "Next Commitment Tier"
                        },
                        {
                          "seriesName": "SentinelCT",
                          "label": "Actual Commitment Tier",
                          "color": "purple"
                        },
                        {
                          "seriesName": "dataPerDay",
                          "color": "green"
                        }
                      ],
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 0,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "name": "query - chart of CR"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": " project actual_ = '{GBperday}' , roundUp_ = round(toreal('{GBperday}'),0)\r\n| extend lookBack = 31\r\n| extend roundUp_ = iif(isnan(roundUp_),toreal(0),toreal(roundUp_))\r\n| extend PAYG_estimate = roundUp_ * {ingestionCost}\r\n| extend discountRate = iif(isempty('{discountRate}'),\"0\",'{discountRate}')    \r\n| extend PAYG_estimate_mthly = (PAYG_estimate * lookBack)\r\n| extend CT_estimate_mthly = PAYG_estimate_mthly * tolong(discountRate) / 100\r\n| summarize by ['Avg GB/day']=roundUp_, [\"PAYG Estimate\"] = PAYG_estimate, [\"PAYG Monthly Estimate\"] = PAYG_estimate_mthly, [\"CT Monthly Estimate\"] = CT_estimate_mthly",
                    "size": 4,
                    "aggregation": 5,
                    "showAnnotations": true,
                    "title": "Commitment Tier. Price per GB:{CommitmentTierPrice},  Discount: {discountRate}%",
                    "exportFieldName": "y",
                    "exportParameterName": "yAxis",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "PAYG_estimate",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "PAYG_estimate_mthly",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "avgDataPerDay",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "PAYG_estimate_daily",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - billing - Copy"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### Commitment Tier for Your Average GB/day Value\r\n\r\nThis report is designed to assist you in determining whether your current Azure Sentinel settings are optimized based on your average data ingestion (GB/day) and your Pay As You Go or commitment tier settings.\r\n\r\n**Indicators:**\r\n\r\n- **Green Circle üü¢ (Status Column):** Indicates that you are on the optimal setting for your data ingestion and cost, meaning your current setup aligns well with your average GB/day usage and selected pricing tier.\r\n\r\n- **Recommended Value \"0\":** This suggests that you are currently on a setting like Free, PerGB, or another non-commitment tier, rather than a specific commitment tier.\r\n\r\n- **Red Cross ‚ùå (Status Column):** Appears if the 'recommended' Sentinel or Workspace setting differs from your 'current' setting, indicating a potential mismatch that may lead to suboptimal costs or performance.\r\n\r\nBefore making any changes to your settings, it's important to review the information provided in the [Azure Sentinel Pricing Page](https://azure.microsoft.com/pricing/details/azure-sentinel/) and the [Azure Monitor Pricing Page](https://azure.microsoft.com/pricing/details/monitor/) to ensure you're making the best decision for your organization‚Äôs needs.",
                    "style": "upsell"
                  },
                  "conditionalVisibility": {
                    "parameterName": "Help",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": " project actual_ = '{GBperday}' , roundUp_ = round(toreal('{GBperday}'),0)\r\n| extend lookBack = 31\r\n| extend i = roundUp_ //* 100\r\n| extend i = iif(isnan(i),toreal(0),toreal(i))\r\n// Sentinel commitment tier logic\r\n| extend recommendedSentinelCT = case(\r\n    i  <= 50,\"0\",\r\n    i between (51 .. 180),\"100\",\r\n    i between (181 .. 286),\"200\",\r\n    i between (287 .. 390),\"300\",\r\n    i between (391 .. 476),\"400\",\r\n    i between (477 .. 975),\"500\",\r\n    i between (976 .. 1897),\"1000\",\r\n    i between (1898 .. 4729),\"2000\",\r\n    i >= 4730 ,\"5000\",\r\n    //else\r\n    strcat(\"unknown Sentinel CT: \", i)\r\n)\r\n// Azure Log Analytics (LAW) commitment tier logic\r\n| extend recommendedWorkspaceCT = case(\r\n    i <= 85,\"0\",\r\n    i between (86 .. 187),\"100\",\r\n    i between (188 .. 293),\"200\",\r\n    i between (294 .. 391),\"300\",\r\n    i between (392 .. 491),\"400\",\r\n    i between (492 .. 982),\"500\",\r\n    i between (983 .. 1952),\"1000\",\r\n    i between (1953 .. 4849),\"2000\",\r\n    i >= 4850 ,\"5000\",\r\n    //else\r\n    strcat(\"unknown LAW CT: \", i)\r\n)\r\n| extend avgDataPerDay = i\r\n| extend currentSentinelCT = iif(isempty('{sentinelCap}'),\"0\",'{sentinelCap}')\r\n| extend currentWorkspaceCT = iif(isempty('{lawCap}'),\"0\",'{lawCap}')\r\n| extend sentinelOptimal = iif(recommendedSentinelCT == currentSentinelCT,1,0)\r\n| extend lawOptimal = iif(recommendedWorkspaceCT == currentWorkspaceCT,1,0)\r\n| summarize by ['Avg GB/day'] = avgDataPerDay, ['Sentinel Status'] = sentinelOptimal, ['Log Analytics Status'] = lawOptimal, [\"Recommended Sentinel CT\"] = recommendedSentinelCT, [\"Recommended Workspace CT\"] = recommendedWorkspaceCT, [\"Current Sentinel CT\"] = currentSentinelCT, [\"Current Workspace CT\"] = currentWorkspaceCT",
                    "size": 4,
                    "title": "Commitment Tier Recommendations",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Sentinel Status",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "1",
                                "representation": "success",
                                "text": ""
                              },
                              {
                                "operator": "Default",
                                "representation": "failed",
                                "text": ""
                              }
                            ]
                          },
                          "tooltipFormat": {
                            "tooltip": "If Current and Recommended settings dont match the avg. GB/day - look to adjust? "
                          }
                        },
                        {
                          "columnMatch": "Log Analytics Status",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "1",
                                "representation": "success",
                                "text": ""
                              },
                              {
                                "operator": "Default",
                                "representation": "failed",
                                "text": ""
                              }
                            ]
                          },
                          "tooltipFormat": {
                            "tooltip": "If Current and Recommended settings dont match the avg. GB/day - look to adjust? "
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - CR optimal"
                }
              ]
            },
            "name": "group - CommitmentData"
          }
        ],
        "exportParameters": true
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Commitment"
      },
      "name": "group - Commitment",
      "styleSettings": {
        "showBorder": true
      }
    }
  ],
  "fromTemplateId": "sentinel-CostSummaryGBP",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}